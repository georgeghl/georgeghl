<!DOCTYPE html>

<html lang="zh-CN" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>docker安装 &#8212; 个人笔记教程 1.0.0 文档</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/classic.css?v=def86cc0" />
    
    <script src="_static/documentation_options.js?v=34088549"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/translations.js?v=beaddf03"></script>
    
    <link rel="index" title="索引" href="genindex.html" />
    <link rel="search" title="搜索" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总索引"
             accesskey="I">索引</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">个人笔记教程 1.0.0 文档</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">docker安装</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="docker">
<h1>docker安装<a class="headerlink" href="#docker" title="Link to this heading">¶</a></h1>
<section id="for-ubuntu">
<h2>官方教程 for Ubuntu<a class="headerlink" href="#for-ubuntu" title="Link to this heading">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#Uninstall old versions</span>
<span class="c1">#Older versions of Docker were called docker, docker.io, or docker-engine. If these are installed, uninstall them:</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>remove<span class="w"> </span>docker<span class="w"> </span>docker-engine<span class="w"> </span>docker.io<span class="w"> </span>containerd<span class="w"> </span>runc

<span class="c1">#Install using the repository</span>
<span class="c1">#Before you install Docker Engine for the first time on a new host machine, you need to set up the Docker repository. Afterward, you can install and update Docker from the repository.</span>
<span class="c1">#Set up the repository</span>
<span class="c1">#Update the apt package index and install packages to allow apt to use a repository over HTTPS:</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>ca-certificates<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>curl<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>gnupg<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>lsb-release

<span class="c1">#Add Docker’s official GPG key:</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/apt/keyrings
curl<span class="w"> </span>-fsSL<span class="w"> </span>https://download.docker.com/linux/ubuntu/gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span>-o<span class="w"> </span>/etc/apt/keyrings/docker.gpg

<span class="c1">#Use the following command to set up the repository:</span>
<span class="nb">echo</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;deb [arch=</span><span class="k">$(</span>dpkg<span class="w"> </span>--print-architecture<span class="k">)</span><span class="s2"> signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \</span>
<span class="s2">  </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> stable&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/docker.list<span class="w"> </span>&gt;<span class="w"> </span>/dev/null
<span class="w">  </span>
<span class="c1">#Install Docker Engine</span>
<span class="c1">#Update the apt package index, and install the latest version of Docker Engine, containerd, and Docker Compose, or go to the next step to install a specific version:</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>docker-ce<span class="w"> </span>docker-ce-cli<span class="w"> </span>containerd.io<span class="w"> </span>docker-compose-plugin
</pre></div>
</div>
</section>
<section id="tsinghua">
<h2>使用Tsinghua源<a class="headerlink" href="#tsinghua" title="Link to this heading">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#如果你过去安装过 docker,先删掉:</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>remove<span class="w"> </span>docker<span class="w"> </span>docker-engine<span class="w"> </span>docker.io<span class="w"> </span>containerd<span class="w"> </span>runc

<span class="c1">#首先安装依赖:</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>apt-transport-https<span class="w"> </span>ca-certificates<span class="w"> </span>curl<span class="w"> </span>gnupg2<span class="w"> </span>software-properties-common

<span class="c1">#根据你的发行版，下面的内容有所不同。</span>
<span class="c1">#Ubuntu</span>
<span class="c1">#信任 Docker 的 GPG 公钥:</span>
curl<span class="w"> </span>-fsSL<span class="w"> </span>https://download.docker.com/linux/ubuntu/gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span>-o<span class="w"> </span>/etc/apt/keyrings/docker.gpg

<span class="c1">#添加软件仓库:</span>
<span class="nb">echo</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;deb [arch=</span><span class="k">$(</span>dpkg<span class="w"> </span>--print-architecture<span class="k">)</span><span class="s2"> signed-by=/etc/apt/keyrings/docker.gpg] https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/ubuntu \</span>
<span class="s2">  </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> stable&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/docker.list<span class="w"> </span>&gt;<span class="w"> </span>/dev/null

<span class="c1">#最后安装</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>docker-ce

<span class="c1">#Fedora/CentOS/RHEL</span>
<span class="c1">#以下内容根据 官方文档 修改而来。</span>
<span class="c1">#如果你之前安装过 docker，请先删掉</span>
sudo<span class="w"> </span>yum<span class="w"> </span>remove<span class="w"> </span>docker<span class="w"> </span>docker-client<span class="w"> </span>docker-client-latest<span class="w"> </span>docker-common<span class="w"> </span>docker-latest<span class="w"> </span>docker-latest-logrotate<span class="w"> </span>docker-logrotate<span class="w"> </span>docker-engine

<span class="c1">#安装一些依赖</span>
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>yum-utils<span class="w"> </span>device-mapper-persistent-data<span class="w"> </span>lvm2

<span class="c1">#根据你的发行版下载repo文件: CentOS/RHEL</span>
yum-config-manager<span class="w"> </span>--add-repo<span class="w"> </span>https://download.docker.com/linux/centos/docker-ce.repo

<span class="c1">#把软件仓库地址替换为 TUNA:</span>
sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s+download.docker.com+mirrors.tuna.tsinghua.edu.cn/docker-ce+&#39;</span><span class="w"> </span>/etc/yum.repos.d/docker-ce.repo

<span class="c1">#最后安装:</span>
sudo<span class="w"> </span>yum<span class="w"> </span>makecache<span class="w"> </span>fast
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>docker-ce
</pre></div>
</div>
</section>
<section id="id1">
<h2>使用阿里源(推荐使用)<a class="headerlink" href="#id1" title="Link to this heading">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#Ubuntu 14.04/16.04（使用 apt-get 进行安装）</span>
<span class="c1"># step 1: 安装必要的一些系统工具</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>apt-transport-https<span class="w"> </span>ca-certificates<span class="w"> </span>curl<span class="w"> </span>software-properties-common
<span class="c1"># step 2: 安装GPG证书</span>
curl<span class="w"> </span>-fsSL<span class="w"> </span>https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>apt-key<span class="w"> </span>add<span class="w"> </span>-
<span class="c1"># Step 3: 写入软件源信息</span>
sudo<span class="w"> </span>add-apt-repository<span class="w"> </span><span class="s2">&quot;deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> stable&quot;</span>
<span class="c1"># Step 4: 更新并安装Docker-CE</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>-y<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>docker-ce

<span class="c1"># 安装指定版本的Docker-CE:</span>
<span class="c1"># Step 1: 查找Docker-CE的版本:</span>
<span class="c1"># apt-cache madison docker-ce</span>
<span class="c1">#   docker-ce | 17.03.1~ce-0~ubuntu-xenial | https://mirrors.aliyun.com/docker-ce/linux/ubuntu xenial/stable amd64 Packages</span>
<span class="c1">#   docker-ce | 17.03.0~ce-0~ubuntu-xenial | https://mirrors.aliyun.com/docker-ce/linux/ubuntu xenial/stable amd64 Packages</span>
<span class="c1"># Step 2: 安装指定版本的Docker-CE: (VERSION例如上面的17.03.1~ce-0~ubuntu-xenial)</span>
<span class="c1"># sudo apt-get -y install docker-ce=[VERSION]</span>



<span class="c1">#CentOS 7（使用 yum 进行安装）</span>
<span class="c1"># step 1: 安装必要的一些系统工具</span>
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>yum-utils<span class="w"> </span>device-mapper-persistent-data<span class="w"> </span>lvm2
<span class="c1"># Step 2: 添加软件源信息</span>
sudo<span class="w"> </span>yum-config-manager<span class="w"> </span>--add-repo<span class="w"> </span>https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
<span class="c1"># Step 3</span>
sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s+download.docker.com+mirrors.aliyun.com/docker-ce+&#39;</span><span class="w"> </span>/etc/yum.repos.d/docker-ce.repo
<span class="c1"># Step 4: 更新并安装Docker-CE</span>
sudo<span class="w"> </span>yum<span class="w"> </span>makecache<span class="w"> </span>fast
sudo<span class="w"> </span>yum<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>docker-ce
<span class="c1"># Step 4: 开启Docker服务</span>
sudo<span class="w"> </span>service<span class="w"> </span>docker<span class="w"> </span>start

<span class="c1"># 注意：</span>
<span class="c1"># 官方软件源默认启用了最新的软件，您可以通过编辑软件源的方式获取各个版本的软件包。例如官方并没有将测试版本的软件源置为可用，您可以通过以下方式开启。同理可以开启各种测试版本等。</span>
<span class="c1"># vim /etc/yum.repos.d/docker-ce.repo</span>
<span class="c1">#   将[docker-ce-test]下方的enabled=0修改为enabled=1</span>
<span class="c1">#</span>
<span class="c1"># 安装指定版本的Docker-CE:</span>
<span class="c1"># Step 1: 查找Docker-CE的版本:</span>
<span class="c1"># yum list docker-ce.x86_64 --showduplicates | sort -r</span>
<span class="c1">#   Loading mirror speeds from cached hostfile</span>
<span class="c1">#   Loaded plugins: branch, fastestmirror, langpacks</span>
<span class="c1">#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            docker-ce-stable</span>
<span class="c1">#   docker-ce.x86_64            17.03.1.ce-1.el7.centos            @docker-ce-stable</span>
<span class="c1">#   docker-ce.x86_64            17.03.0.ce-1.el7.centos            docker-ce-stable</span>
<span class="c1">#   Available Packages</span>
<span class="c1"># Step2: 安装指定版本的Docker-CE: (VERSION例如上面的17.03.0.ce.1-1.el7.centos)</span>
<span class="c1"># sudo yum -y install docker-ce-[VERSION]</span>
</pre></div>
</div>
</section>
<section id="ustc">
<h2>使用ustc源<a class="headerlink" href="#ustc" title="Link to this heading">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#安装 Docker CE，请按照 官方安装文档 ，选择你对应的系统。 以 Ubuntu 为例，参考 官方 Ubuntu 安装 Docker CE 手册 进行安装。 在阅读官方安装手册时，只要把 download.docker.com 地址换成 mirrors.ustc.edu.cn/docker-ce 即可。</span>
<span class="c1">#CentOS、 Fedora 等用户在下载 docker-ce.repo 文件后（位于 /etc/yum.repos.d/）， 还需要将该文件中的 download.docker.com 地址换成 mirrors.ustc.edu.cn/docker-ce。</span>


<span class="c1">#Uninstall old versions</span>
<span class="c1">#Older versions of Docker were called docker, docker.io, or docker-engine. If these are installed, uninstall them:</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>remove<span class="w"> </span>docker<span class="w"> </span>docker-engine<span class="w"> </span>docker.io<span class="w"> </span>containerd<span class="w"> </span>runc

<span class="c1">#Install using the repository</span>
<span class="c1">#Before you install Docker Engine for the first time on a new host machine, you need to set up the Docker repository. Afterward, you can install and update Docker from the repository.</span>
<span class="c1">#Set up the repository</span>
<span class="c1">#Update the apt package index and install packages to allow apt to use a repository over HTTPS:</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>ca-certificates<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>curl<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>gnupg<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>lsb-release

<span class="c1">#Add Docker’s official GPG key:</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/etc/apt/keyrings
curl<span class="w"> </span>-fsSL<span class="w"> </span>https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu/gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>gpg<span class="w"> </span>--dearmor<span class="w"> </span>-o<span class="w"> </span>/etc/apt/keyrings/docker.gpg

<span class="c1">#Use the following command to set up the repository:</span>
<span class="nb">echo</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span><span class="s2">&quot;deb [arch=</span><span class="k">$(</span>dpkg<span class="w"> </span>--print-architecture<span class="k">)</span><span class="s2"> signed-by=/etc/apt/keyrings/docker.gpg] https://mirrors.ustc.edu.cn/docker-ce/linux/ubuntu \</span>
<span class="s2">  </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> stable&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/docker.list<span class="w"> </span>&gt;<span class="w"> </span>/dev/null
<span class="w">  </span>
<span class="c1">#Install Docker Engine</span>
<span class="c1">#Update the apt package index, and install the latest version of Docker Engine, containerd, and Docker Compose, or go to the next step to install a specific version:</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>docker-ce<span class="w"> </span>docker-ce-cli<span class="w"> </span>containerd.io<span class="w"> </span>docker-compose-plugin
</pre></div>
</div>
</section>
<section id="sjtu">
<h2>使用sjtu源<a class="headerlink" href="#sjtu" title="Link to this heading">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#如果你过去安装过 docker，先删掉:</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>remove<span class="w"> </span>docker<span class="w"> </span>docker-engine<span class="w"> </span>docker.io
<span class="c1">#首先安装依赖:</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>apt-transport-https<span class="w"> </span>ca-certificates<span class="w"> </span>curl<span class="w"> </span>gnupg2<span class="w"> </span>software-properties-common
<span class="c1">#根据你的发行版，下面的内容有所不同。你使用的发行版：</span>


<span class="c1">#Debian</span>
<span class="c1">#信任 Docker 的 GPG 公钥:</span>
curl<span class="w"> </span>-fsSL<span class="w"> </span>https://download.docker.com/linux/debian/gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>apt-key<span class="w"> </span>add<span class="w"> </span>-
<span class="c1">#对于 amd64 架构的计算机，添加软件仓库:</span>
sudo<span class="w"> </span>add-apt-repository<span class="w"> </span><span class="se">\</span>
<span class="w">   </span><span class="s2">&quot;deb [arch=amd64] https://mirror.sjtu.edu.cn/docker-ce/linux/debian \</span>
<span class="s2">   </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> \</span>
<span class="s2">   stable&quot;</span>
<span class="c1">#如果你用的是树莓派或其它ARM架构计算机，请运行:</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [arch=armhf] https://mirror.sjtu.edu.cn/docker-ce/linux/debian \</span>
<span class="s2">     </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> stable&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/docker.list
<span class="c1">#最后安装</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>docker-ce


<span class="c1">#Ubuntu</span>
<span class="c1">#信任 Docker 的 GPG 公钥:</span>
curl<span class="w"> </span>-fsSL<span class="w"> </span>https://download.docker.com/linux/ubuntu/gpg<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>apt-key<span class="w"> </span>add<span class="w"> </span>-
<span class="c1">#对于 amd64 架构的计算机，添加软件仓库:</span>
sudo<span class="w"> </span>add-apt-repository<span class="w"> </span><span class="se">\</span>
<span class="w">   </span><span class="s2">&quot;deb [arch=amd64] https://mirror.sjtu.edu.cn/docker-ce/linux/ubuntu \</span>
<span class="s2">   </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> \</span>
<span class="s2">   stable&quot;</span>
<span class="c1">#如果你用的是树莓派或其它ARM架构计算机，请运行:</span>
<span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;deb [arch=armhf] https://mirror.sjtu.edu.cn/docker-ce/linux/ubuntu \</span>
<span class="s2">     </span><span class="k">$(</span>lsb_release<span class="w"> </span>-cs<span class="k">)</span><span class="s2"> stable&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>sudo<span class="w"> </span>tee<span class="w"> </span>/etc/apt/sources.list.d/docker.list
<span class="c1">#最后安装</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>docker-ce


<span class="c1">#Fedora/CentOS/RHEL</span>
<span class="c1">#以下内容根据TUNA文档修改而来。</span>
<span class="c1">#如果你之前安装过 docker，请先删掉</span>
sudo<span class="w"> </span>yum<span class="w"> </span>remove<span class="w"> </span>docker<span class="w"> </span>docker-common<span class="w"> </span>docker-selinux<span class="w"> </span>docker-engine
<span class="c1">#安装一些依赖</span>
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>yum-utils<span class="w"> </span>device-mapper-persistent-data<span class="w"> </span>lvm2
<span class="c1">#根据你的发行版下载repo文件:</span>


<span class="c1">#CentOS/RHEL</span>
<span class="c1">#Fedora</span>
<span class="c1">#把软件仓库地址替换为 SJTUG:</span>
sudo<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span><span class="s1">&#39;s+download.docker.com+mirror.sjtu.edu.cn/docker-ce+&#39;</span><span class="w"> </span>/etc/yum.repos.d/docker-ce.repo
<span class="c1">#最后安装:</span>
sudo<span class="w"> </span>yum<span class="w"> </span>makecache<span class="w"> </span>fast
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>docker-ce
</pre></div>
</div>
</section>
</section>
<section id="docker-compose">
<h1>docker-compose安装<a class="headerlink" href="#docker-compose" title="Link to this heading">¶</a></h1>
<section id="apt">
<h2>apt安装<a class="headerlink" href="#apt" title="Link to this heading">¶</a></h2>
<p>直接使用apt-get install</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>docker-compose
</pre></div>
</div>
</section>
</section>
<section id="id2">
<h1>docker走代理<a class="headerlink" href="#id2" title="Link to this heading">¶</a></h1>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/etc/systemd/system/
<span class="c1">#创建配置文件</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>docker.service.d
<span class="nb">cd</span><span class="w"> </span>docker.service.d
sudo<span class="w"> </span>vim<span class="w"> </span>proxy.conf

<span class="c1">#切换到插入模式，插入以下内容</span>
<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">Environment</span><span class="o">=</span><span class="s2">&quot;HTTP_PROXY=127.0.0.1:7890&quot;</span>
<span class="nv">Environment</span><span class="o">=</span><span class="s2">&quot;HTTPS_PROXY=127.0.0.1:7890&quot;</span>
<span class="c1">#保存退出</span>

<span class="c1">#重启docker</span>
sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>docker

<span class="c1">#最后我们仍然是验证一下是否修改成功，运行</span>
sudo<span class="w"> </span>docker<span class="w"> </span>info
<span class="c1">#在长串info信息中如果出现类似下文的内容：</span>
<span class="c1"># HTTP Proxy: 代理服务器ip:port</span>
<span class="c1"># HTTPS Proxy: 代理服务器ip:port</span>
</pre></div>
</div>
</section>
<section id="wsldocker">
<h1>WSL设置docker代理<a class="headerlink" href="#wsldocker" title="Link to this heading">¶</a></h1>
<p>当启动docker服务时，后调用<code class="docutils literal notranslate"><span class="pre">/etc/init.d/docker</span></code>脚本，而此脚本会执行<code class="docutils literal notranslate"><span class="pre">/etc/default/docker</span></code>脚本，因此可在后者设置代理的环境变量，由此docker拉取镜像时便会使用代理。</p>
<p>修改<code class="docutils literal notranslate"><span class="pre">/etc/default/docker</span></code>文件，加入以下内容:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span><span class="w"> </span><span class="nv">http_proxy</span><span class="o">=</span><span class="s2">&quot;127.0.0.1:7890&quot;</span>
<span class="nb">export</span><span class="w"> </span><span class="nv">https_proxy</span><span class="o">=</span><span class="s2">&quot;127.0.0.1:7890&quot;</span>
<span class="c1"># 注意：https代理链接为http，Windows IP即为宿主机IP</span>
</pre></div>
</div>
<p>重启docker：sudo service docker restart</p>
</section>
<section id="portainer-docker">
<h1>Portainer(docker面板)<a class="headerlink" href="#portainer-docker" title="Link to this heading">¶</a></h1>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#拉取镜像</span>
sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>portainer/portainer-ce:latest
</pre></div>
</div>
<p>创建并启动容器</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#不映射数据</span>
sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">8000</span>:8000<span class="w"> </span>-p<span class="w"> </span><span class="m">9443</span>:9443<span class="w"> </span>-p<span class="w"> </span><span class="m">9000</span>:9000<span class="w"> </span>--name<span class="w"> </span>portainer<span class="w"> </span>--restart<span class="o">=</span>always<span class="w"> </span>-v<span class="w"> </span>/var/run/docker.sock:/var/run/docker.sock<span class="w"> </span>portainer/portainer-ce:latest
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#映射数据至指定目录</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/mnt/toshiba/docker/portainer-default/
sudo<span class="w"> </span>chown<span class="w"> </span>ubuntu<span class="w"> </span>/mnt/toshiba/docker/portainer-default/
sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">8000</span>:8000<span class="w"> </span>-p<span class="w"> </span><span class="m">9443</span>:9443<span class="w"> </span>-p<span class="w"> </span><span class="m">9000</span>:9000<span class="w"> </span>--name<span class="w"> </span>portainer<span class="w"> </span>--restart<span class="o">=</span>always<span class="w"> </span>-v<span class="w"> </span>/var/run/docker.sock:/var/run/docker.sock<span class="w"> </span>-v<span class="w"> </span>/mnt/toshiba/docker/portainer-default:/data<span class="w"> </span>portainer/portainer-ce:latest
</pre></div>
</div>
<p>创建完毕后，访问9000端口。</p>
</section>
<section id="grafana">
<h1>Grafana<a class="headerlink" href="#grafana" title="Link to this heading">¶</a></h1>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="o">=</span>grafana<span class="w"> </span>-p<span class="w"> </span><span class="m">3000</span>:3000<span class="w"> </span>grafana/grafana

docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="o">=</span>grafana<span class="w"> </span>-p<span class="w"> </span><span class="m">3000</span>:3000<span class="w"> </span>grafana/grafana-enterprise
</pre></div>
</div>
</section>
<section id="uptime-kuma">
<h1>uptime-kuma(应用监控)<a class="headerlink" href="#uptime-kuma" title="Link to this heading">¶</a></h1>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>elestio/uptime-kuma:1.23.10

sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-itd<span class="w"> </span>--name<span class="w"> </span>uptime-kuma-default<span class="w"> </span>-p<span class="w"> </span><span class="m">13001</span>:3001<span class="w">  </span>elestio/uptime-kuma:1.23.10
</pre></div>
</div>
</section>
<section id="minio">
<h1>minio(分布式对象存储服务器)<a class="headerlink" href="#minio" title="Link to this heading">¶</a></h1>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>minio/minio:latest
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/mnt/toshiba/docker/minio-default/data
sudo<span class="w"> </span>chown<span class="w"> </span>ubuntu<span class="w"> </span>/mnt/toshiba/docker/minio-default/data
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/mnt/toshiba/docker/minio-default/config
sudo<span class="w"> </span>chown<span class="w"> </span>ubuntu<span class="w"> </span>/mnt/toshiba/docker/minio-default/config
<span class="c1"># 指定用户名和密码</span>
sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-itd<span class="w"> </span>--restart<span class="o">=</span>always<span class="w"> </span>--name<span class="w"> </span>minio-default<span class="w"> </span>-p<span class="w"> </span><span class="m">9900</span>:9000<span class="w"> </span>-p<span class="w"> </span><span class="m">9901</span>:9001<span class="w"> </span>-v<span class="w"> </span>/mnt/toshiba/docker/minio-default/data:/data<span class="w"> </span>-v<span class="w"> </span>/mnt/toshiba/docker/minio-default/config:/root/.minio<span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;MINIO_ROOT_USER=minioadmin&quot;</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;MINIO_ROOT_PASSWORD=10203090&quot;</span><span class="w"> </span>minio/minio:latest<span class="w"> </span>server<span class="w"> </span>/data<span class="w"> </span>--console-address<span class="w"> </span><span class="s2">&quot;:9001&quot;</span>


<span class="c1"># 不指定用户名和密码，默认为minioadmin,minioadmin</span>
sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-itd<span class="w"> </span>--restart<span class="o">=</span>always<span class="w"> </span>--name<span class="w"> </span>minio-default<span class="w"> </span>-p<span class="w"> </span><span class="m">9900</span>:9000<span class="w"> </span>-p<span class="w"> </span><span class="m">9901</span>:9001<span class="w"> </span>-v<span class="w"> </span>/mnt/toshiba/docker/minio-default/data:/data<span class="w"> </span>-v<span class="w"> </span>/mnt/toshiba/docker/minio-default/config:/root/.minio<span class="w"> </span>minio/minio:latest<span class="w"> </span>server<span class="w"> </span>/data<span class="w"> </span>--console-address<span class="w"> </span><span class="s2">&quot;:9001&quot;</span>
</pre></div>
</div>
</section>
<section id="sun-panel">
<h1>sun-panel<a class="headerlink" href="#sun-panel" title="Link to this heading">¶</a></h1>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--restart<span class="o">=</span>always<span class="w"> </span>-p<span class="w"> </span><span class="m">8226</span>:3002<span class="w"> </span>-v<span class="w"> </span>~/docker_data/sun-panel/conf:/app/conf<span class="w"> </span>-v<span class="w"> </span>/var/run/docker.sock:/var/run/docker.sock<span class="w"> </span>--name<span class="w"> </span>sun-panel<span class="w"> </span>hslr/sun-panel:1.5.2
</pre></div>
</div>
<p>默认账号密码</p>
<p>账号：admin&#64;sun.cc</p>
<p>密码：12345678</p>
</section>
<section id="panel-linux">
<h1>1panel(Linux运维面板)<a class="headerlink" href="#panel-linux" title="Link to this heading">¶</a></h1>
<p>https://hub.docker.com/r/moelin/1panel</p>
<p>由于容器内部<code class="docutils literal notranslate"><span class="pre">systemd</span></code>限制，部分功能目前尚不完整。</p>
<p><strong>20230919：添加自动修改面板显示应用版本，无需手动修改数据库</strong></p>
<p>相关操作查看下文。</p>
<ol class="simple">
<li><p>默认端口：<code class="docutils literal notranslate"><span class="pre">10086</span></code></p></li>
<li><p>默认账户：<code class="docutils literal notranslate"><span class="pre">1panel</span></code></p></li>
<li><p>默认密码：<code class="docutils literal notranslate"><span class="pre">1panel_password</span></code></p></li>
<li><p>默认入口：<code class="docutils literal notranslate"><span class="pre">entrance</span></code></p></li>
</ol>
<p>docker方式安装：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>moelin/1panel:v1.10.1-lts

sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>1panel-default<span class="w"> </span>--restart<span class="w"> </span>always<span class="w"> </span>--network<span class="w"> </span>host<span class="w"> </span>-p<span class="w"> </span><span class="m">10086</span>:10086<span class="w"> </span>-v<span class="w"> </span>/var/run/docker.sock:/var/run/docker.sock<span class="w"> </span>-v<span class="w"> </span>/var/lib/docker/volumes:/var/lib/docker/volumes<span class="w"> </span>-v<span class="w"> </span>/opt:/opt<span class="w"> </span>-v<span class="w"> </span>/root:/root<span class="w"> </span>-e<span class="w"> </span><span class="nv">TZ</span><span class="o">=</span>Asia/Shanghai<span class="w"> </span>moelin/1panel:v1.10.1-lts
</pre></div>
</div>
<p>docker-compose方式安装：</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1">#创建一个docker-compose.yml文件，内容类似如下</span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3&#39;</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">1panel</span><span class="p">:</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1panel</span><span class="w"> </span><span class="c1"># 容器名</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">always</span>
<span class="w">    </span><span class="nt">network_mode</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;host&quot;</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/run/docker.sock:/var/run/docker.sock</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/docker/volumes:/var/lib/docker/volumes</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/opt:/opt</span><span class="w">  </span><span class="c1"># 文件存储映射</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/root:/root</span><span class="w">  </span><span class="c1"># 可选的文件存储映射</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TZ=Asia/Shanghai</span><span class="w">  </span><span class="c1"># 时区设置</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">moelin/1panel:latest</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span><span class="w">  </span>
<span class="w">      </span><span class="nt">createdBy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Apps&quot;</span>
<span class="c1">#然后docker-compose up -d运行</span>
</pre></div>
</div>
</section>
<section id="code-server">
<h1>code-server<a class="headerlink" href="#code-server" title="Link to this heading">¶</a></h1>
<section id="codercon-code-server">
<h2>codercon/code-server<a class="headerlink" href="#codercon-code-server" title="Link to this heading">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#sudo docker pull codercom/code-server:4.89.1-39</span>
sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>codercom/code-server:latest
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/code-server/project/
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/code-server/.config/

<span class="c1">#sudo docker run -itd --name code-server-default -p 8240:8080 -v &quot;/home/ubuntu/docker/code-server/.config:/home/coder/.config&quot; -v &quot;/home/ubuntu/docker/code-server/project:/home/coder/project&quot; -u &quot;$(id -u):$(id -g)&quot; -e &quot;DOCKER_USER=$USER&quot; codercom/code-server:4.89.1-39</span>

sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-itd<span class="w"> </span>--name<span class="w"> </span>code-server-default<span class="w"> </span>-p<span class="w"> </span><span class="m">8240</span>:8080<span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;/home/ubuntu/docker/code-server/.config:/home/coder/.config&quot;</span><span class="w"> </span>-v<span class="w"> </span><span class="s2">&quot;/home/ubuntu/docker/code-server/project:/home/coder/project&quot;</span><span class="w"> </span>-u<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>id<span class="w"> </span>-u<span class="k">)</span><span class="s2">:</span><span class="k">$(</span>id<span class="w"> </span>-g<span class="k">)</span><span class="s2">&quot;</span><span class="w"> </span>-e<span class="w"> </span><span class="s2">&quot;DOCKER_USER=</span><span class="nv">$USER</span><span class="s2">&quot;</span><span class="w"> </span>codercom/code-server:latest

<span class="c1">#sudo docker run -itd --name code-server-default -p 8240:8080 -v &quot;/home/ubuntu/docker/code-server/.config:/home/coder/.config&quot; -v &quot;/home/ubuntu/docker/code-server/project:/home/coder/project&quot; -u &quot;$(id -u):$(id -g)&quot; -e &quot;DOCKER_USER=$USER&quot; -e PASSWORD=123456 codercom/code-server:latest</span>
</pre></div>
</div>
<p>密码在<code class="docutils literal notranslate"><span class="pre">.config/code-server/config.yaml</span></code>中。</p>
</section>
<section id="linuxserver-code-server">
<h2>linuxserver/code-server<a class="headerlink" href="#linuxserver-code-server" title="Link to this heading">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#docker pull linuxserver/code-server:4.89.1</span>
docker<span class="w"> </span>pull<span class="w"> </span>linuxserver/code-server:latest
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/code-server/project/
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/code-server/config/

<span class="c1">#docker run -d --name=code-server -e PUID=1000 -e PGID=1000 -e TZ=Etc/UTC -e PASSWORD=password -e SUDO_PASSWORD=password -e DEFAULT_WORKSPACE=/config/workspace -p 8240:8443 -v /home/ubuntu/docker/code-server/config:/config --restart unless-stopped linuxserver/code-server:4.89.1</span>

docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="o">=</span>code-server<span class="w"> </span>-e<span class="w"> </span><span class="nv">PUID</span><span class="o">=</span><span class="m">1000</span><span class="w"> </span>-e<span class="w"> </span><span class="nv">PGID</span><span class="o">=</span><span class="m">1000</span><span class="w"> </span>-e<span class="w"> </span><span class="nv">TZ</span><span class="o">=</span>Etc/UTC<span class="w"> </span>-e<span class="w"> </span><span class="nv">PASSWORD</span><span class="o">=</span>password<span class="w"> </span>-e<span class="w"> </span><span class="nv">SUDO_PASSWORD</span><span class="o">=</span>password<span class="w"> </span>-e<span class="w"> </span><span class="nv">DEFAULT_WORKSPACE</span><span class="o">=</span>/config/workspace<span class="w"> </span>-p<span class="w"> </span><span class="m">8240</span>:8443<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu/docker/code-server/config:/config<span class="w"> </span>--restart<span class="w"> </span>unless-stopped<span class="w"> </span>linuxserver/code-server:latest
</pre></div>
</div>
</section>
</section>
<section id="mysql8">
<h1>mysql8部署<a class="headerlink" href="#mysql8" title="Link to this heading">¶</a></h1>
<section id="id3">
<h2>部署命令<a class="headerlink" href="#id3" title="Link to this heading">¶</a></h2>
<p>拉取镜像</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>mysql
</pre></div>
</div>
<p>运行</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#创建映射目录</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/mysql-default/conf
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/mysql-default/logs
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/mysql-default/data

<span class="c1">#启动容器</span>
sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-it<span class="w"> </span>--name<span class="w"> </span>mysql-default<span class="w"> </span>-p<span class="w"> </span><span class="m">3080</span>:3306<span class="w"> </span>-e<span class="w"> </span><span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span><span class="m">123456</span><span class="w"> </span>--restart<span class="o">=</span>always<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu/docker/mysql-default/conf:/etc/mysql/conf.d<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu/docker/mysql-default/logs:/var/log/mysql<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu/docker/mysql-default/data:/var/lib/mysql<span class="w"> </span>mysql

<span class="c1"># 报错：[ERROR] [Entrypoint]: mysqld failed while attempting to check config</span>
<span class="c1">#        command was: mysqld --verbose --help --log-bin-index=/tmp/tmp.UI6ajKmnml</span>
<span class="c1">#        mysqld: Can&#39;t read dir of &#39;/etc/mysql/conf.d/&#39; (OS errno 2 - No such file or #directory)</span>
<span class="c1"># mysql5.7的配置在 /etc/mysql</span>
<span class="c1"># mysql8.0以上的配置位置在 /etc/mysql/conf.d</span>
<span class="c1">#/mydata/mysql/conf:/etc/mysql</span>
<span class="c1">#					||</span>
<span class="c1">#					||</span>
<span class="c1">#					||</span>
<span class="c1">#					\/</span>
<span class="c1">#/mydata/mysql/conf:/etc/mysql/conf.d</span>
</pre></div>
</div>
</section>
<section id="id4">
<h2>配置命令<a class="headerlink" href="#id4" title="Link to this heading">¶</a></h2>
<p>进入容器</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>mysql-default<span class="w"> </span>/bin/bash
</pre></div>
</div>
</section>
</section>
<section id="mysql5-7">
<h1>mysql5.7部署<a class="headerlink" href="#mysql5-7" title="Link to this heading">¶</a></h1>
<section id="id5">
<h2>部署命令<a class="headerlink" href="#id5" title="Link to this heading">¶</a></h2>
<p>拉取镜像</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>mysql:5.7
</pre></div>
</div>
<p>运行</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#创建映射目录</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/mysql5-default/conf
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/mysql5-default/logs
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/mysql5-default/mysql

<span class="c1">#创建配置文件</span>
<span class="nb">cd</span><span class="w"> </span>/home/ubuntu/docker/mysql5-default/conf/
sudo<span class="w"> </span>vi<span class="w"> </span>my.cnf
‘’‘
<span class="c1"># Copyright (c) 2014, 2016, Oracle and/or its affiliates. All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># This program is free software; you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation; version 2 of the License.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program; if not, write to the Free Software</span>
<span class="c1"># Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301 USA</span>

<span class="c1">#</span>
<span class="c1"># The MySQL  Server configuration file.</span>
<span class="c1">#</span>
<span class="c1"># For explanations see</span>
<span class="c1"># http://dev.mysql.com/doc/mysql/en/server-system-variables.html</span>

<span class="o">[</span>mysqld<span class="o">]</span>
pid-file<span class="w">	</span><span class="o">=</span><span class="w"> </span>/var/run/mysqld/mysqld.pid
<span class="nv">socket</span><span class="w">		</span><span class="o">=</span><span class="w"> </span>/var/run/mysqld/mysqld.sock
<span class="nv">datadir</span><span class="w">		</span><span class="o">=</span><span class="w"> </span>/var/lib/mysql
<span class="c1">#log-error	= /var/log/mysql/error.log</span>
<span class="c1"># Disabling symbolic-links is recommended to prevent assorted security risks</span>
symbolic-links<span class="o">=</span><span class="m">0</span>

<span class="nv">max_connections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2000</span>
<span class="nv">max_user_connections</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1900</span>
<span class="nv">max_connect_errors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100000</span>
<span class="nv">max_allowed_packet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>50M
<span class="nv">lower_case_table_names</span><span class="o">=</span><span class="m">1</span>
<span class="o">[</span>mysqld<span class="o">]</span>
skip-name-resolve
<span class="nv">sql_mode</span><span class="o">=</span>STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION
’‘’
<span class="c1">#保存后退出</span>


<span class="c1">#启动容器</span>
sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w">  </span>-p<span class="w"> </span><span class="m">3090</span>:3306<span class="w"> </span>--name<span class="w"> </span>mysql5-default<span class="w"> </span>--restart<span class="o">=</span>always<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu/docker/mysql5-default/conf/my.cnf:/etc/mysql/my.cnf<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu/docker/mysql5-default/logs:/logs<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu/docker/mysql5-default/mysql:/var/lib/mysql<span class="w"> </span>-e<span class="w"> </span><span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span><span class="m">123456</span><span class="w"> </span>-d<span class="w"> </span>mysql:5.7
</pre></div>
</div>
</section>
<section id="id6">
<h2>配置命令<a class="headerlink" href="#id6" title="Link to this heading">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="n">mysql5</span><span class="o">-</span><span class="n">default</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">bash</span>
</pre></div>
</div>
</section>
</section>
<section id="mongodb">
<h1>mongodb部署<a class="headerlink" href="#mongodb" title="Link to this heading">¶</a></h1>
<section id="id7">
<h2>部署命令<a class="headerlink" href="#id7" title="Link to this heading">¶</a></h2>
<p>拉取镜像</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>mongo
</pre></div>
</div>
<p>运行</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>--name<span class="o">=</span>mongodb-default<span class="w"> </span>--restart<span class="o">=</span>always<span class="w"> </span>-p<span class="w"> </span><span class="m">27017</span>:27017<span class="w"> </span>-itd<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu/docker/mongodb-default/data:/data/db<span class="w"> </span>-v/home/ubuntu/docker/mongodb-default/backup:/data/backup<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu/docker/mongodb-default/conf:/data/configdb<span class="w"> </span>mongo<span class="w"> </span>--auth
</pre></div>
</div>
<p>进入mongo容器</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>mongodb-default<span class="w"> </span>mongosh<span class="w"> </span>admin
</pre></div>
</div>
<p>添加账号</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>db.createUser<span class="o">({</span>user:<span class="s1">&#39;admin&#39;</span>,pwd:<span class="s1">&#39;123456&#39;</span>,roles:<span class="o">[{</span>role:<span class="s1">&#39;root&#39;</span>,db:<span class="s1">&#39;admin&#39;</span><span class="o">}]</span>,<span class="o">})</span><span class="p">;</span>
db.auth<span class="o">(</span><span class="s1">&#39;admin&#39;</span>,<span class="s1">&#39;123456&#39;</span><span class="o">)</span><span class="p">;</span>
<span class="c1">#读取权限的账户</span>
db.createUser<span class="o">({</span>user:<span class="s1">&#39;user&#39;</span>,pwd:<span class="s1">&#39;123456&#39;</span>,roles:<span class="o">[{</span>role:<span class="s2">&quot;readWrite&quot;</span>,db:<span class="s2">&quot;elec_safe&quot;</span><span class="o">}]})</span><span class="p">;</span>
db.auth<span class="o">(</span><span class="s2">&quot;user&quot;</span>,<span class="s2">&quot;123456&quot;</span><span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
</section>
</section>
<section id="apache2">
<h1>apache2部署<a class="headerlink" href="#apache2" title="Link to this heading">¶</a></h1>
<section id="id8">
<h2>部署命令<a class="headerlink" href="#id8" title="Link to this heading">¶</a></h2>
<p>拉取镜像</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>httpd
</pre></div>
</div>
<p>运行</p>
<p>注：若容器运行后自动无限重启，可使用<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">docker</span> <span class="pre">logs</span> <span class="pre">httpd-default</span></code>查看日志输出。</p>
<p>如果输出日志报错<code class="docutils literal notranslate"><span class="pre">AH00534:</span> <span class="pre">httpd............</span></code>，则根据以下命令，在启动容器前先修改httpd.conf的内容/或直接复制全新的httpd.conf。</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#创建映射目录</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/httpd-default/htdocs
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/httpd-default/conf
sudo<span class="w"> </span>touch<span class="w"> </span>/home/ubuntu/docker/httpd-default/conf/httpd.conf
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/httpd-default/logs

<span class="c1">#编辑httpd.conf文件内容</span>
<span class="s1">&#39;&#39;&#39;</span>
<span class="s1">#</span>
<span class="s1"># This is the main Apache HTTP server configuration file.  It contains the</span>
<span class="s1"># configuration directives that give the server its instructions.</span>
<span class="s1"># See &lt;URL:http://httpd.apache.org/docs/2.4/&gt; for detailed information.</span>
<span class="s1"># In particular, see </span>
<span class="s1"># &lt;URL:http://httpd.apache.org/docs/2.4/mod/directives.html&gt;</span>
<span class="s1"># for a discussion of each configuration directive.</span>
<span class="s1">#</span>
<span class="s1"># Do NOT simply read the instructions in here without understanding</span>
<span class="s1"># what they do.  They&#39;</span>re<span class="w"> </span>here<span class="w"> </span>only<span class="w"> </span>as<span class="w"> </span>hints<span class="w"> </span>or<span class="w"> </span>reminders.<span class="w">  </span>If<span class="w"> </span>you<span class="w"> </span>are<span class="w"> </span>unsure
<span class="c1"># consult the online docs. You have been warned.  </span>
<span class="c1">#</span>
<span class="c1"># Configuration and logfile names: If the filenames you specify for many</span>
<span class="c1"># of the server&#39;s control files begin with &quot;/&quot; (or &quot;drive:/&quot; for Win32), the</span>
<span class="c1"># server will use that explicit path.  If the filenames do *not* begin</span>
<span class="c1"># with &quot;/&quot;, the value of ServerRoot is prepended -- so &quot;logs/access_log&quot;</span>
<span class="c1"># with ServerRoot set to &quot;/usr/local/apache2&quot; will be interpreted by the</span>
<span class="c1"># server as &quot;/usr/local/apache2/logs/access_log&quot;, whereas &quot;/logs/access_log&quot; </span>
<span class="c1"># will be interpreted as &#39;/logs/access_log&#39;.</span>

<span class="c1">#</span>
<span class="c1"># ServerRoot: The top of the directory tree under which the server&#39;s</span>
<span class="c1"># configuration, error, and log files are kept.</span>
<span class="c1">#</span>
<span class="c1"># Do not add a slash at the end of the directory path.  If you point</span>
<span class="c1"># ServerRoot at a non-local disk, be sure to specify a local disk on the</span>
<span class="c1"># Mutex directive, if file-based mutexes are used.  If you wish to share the</span>
<span class="c1"># same ServerRoot for multiple httpd daemons, you will need to change at</span>
<span class="c1"># least PidFile.</span>
<span class="c1">#</span>
ServerRoot<span class="w"> </span><span class="s2">&quot;/usr/local/apache2&quot;</span>

<span class="c1">#</span>
<span class="c1"># Mutex: Allows you to set the mutex mechanism and mutex file directory</span>
<span class="c1"># for individual mutexes, or change the global defaults</span>
<span class="c1">#</span>
<span class="c1"># Uncomment and change the directory if mutexes are file-based and the default</span>
<span class="c1"># mutex file directory is not on a local disk or is not appropriate for some</span>
<span class="c1"># other reason.</span>
<span class="c1">#</span>
<span class="c1"># Mutex default:logs</span>

<span class="c1">#</span>
<span class="c1"># Listen: Allows you to bind Apache to specific IP addresses and/or</span>
<span class="c1"># ports, instead of the default. See also the &lt;VirtualHost&gt;</span>
<span class="c1"># directive.</span>
<span class="c1">#</span>
<span class="c1"># Change this to Listen on specific IP addresses as shown below to </span>
<span class="c1"># prevent Apache from glomming onto all bound IP addresses.</span>
<span class="c1">#</span>
<span class="c1">#Listen 12.34.56.78:80</span>
Listen<span class="w"> </span><span class="m">80</span>

<span class="c1">#</span>
<span class="c1"># Dynamic Shared Object (DSO) Support</span>
<span class="c1">#</span>
<span class="c1"># To be able to use the functionality of a module which was built as a DSO you</span>
<span class="c1"># have to place corresponding `LoadModule&#39; lines at this location so the</span>
<span class="c1"># directives contained in it are actually available _before_ they are used.</span>
<span class="c1"># Statically compiled modules (those listed by `httpd -l&#39;) do not need</span>
<span class="c1"># to be loaded here.</span>
<span class="c1">#</span>
<span class="c1"># Example:</span>
<span class="c1"># LoadModule foo_module modules/mod_foo.so</span>
<span class="c1">#</span>
LoadModule<span class="w"> </span>mpm_event_module<span class="w"> </span>modules/mod_mpm_event.so
<span class="c1">#LoadModule mpm_prefork_module modules/mod_mpm_prefork.so</span>
<span class="c1">#LoadModule mpm_worker_module modules/mod_mpm_worker.so</span>
LoadModule<span class="w"> </span>authn_file_module<span class="w"> </span>modules/mod_authn_file.so
<span class="c1">#LoadModule authn_dbm_module modules/mod_authn_dbm.so</span>
<span class="c1">#LoadModule authn_anon_module modules/mod_authn_anon.so</span>
<span class="c1">#LoadModule authn_dbd_module modules/mod_authn_dbd.so</span>
<span class="c1">#LoadModule authn_socache_module modules/mod_authn_socache.so</span>
LoadModule<span class="w"> </span>authn_core_module<span class="w"> </span>modules/mod_authn_core.so
LoadModule<span class="w"> </span>authz_host_module<span class="w"> </span>modules/mod_authz_host.so
LoadModule<span class="w"> </span>authz_groupfile_module<span class="w"> </span>modules/mod_authz_groupfile.so
LoadModule<span class="w"> </span>authz_user_module<span class="w"> </span>modules/mod_authz_user.so
<span class="c1">#LoadModule authz_dbm_module modules/mod_authz_dbm.so</span>
<span class="c1">#LoadModule authz_owner_module modules/mod_authz_owner.so</span>
<span class="c1">#LoadModule authz_dbd_module modules/mod_authz_dbd.so</span>
LoadModule<span class="w"> </span>authz_core_module<span class="w"> </span>modules/mod_authz_core.so
<span class="c1">#LoadModule authnz_ldap_module modules/mod_authnz_ldap.so</span>
<span class="c1">#LoadModule authnz_fcgi_module modules/mod_authnz_fcgi.so</span>
LoadModule<span class="w"> </span>access_compat_module<span class="w"> </span>modules/mod_access_compat.so
LoadModule<span class="w"> </span>auth_basic_module<span class="w"> </span>modules/mod_auth_basic.so
<span class="c1">#LoadModule auth_form_module modules/mod_auth_form.so</span>
<span class="c1">#LoadModule auth_digest_module modules/mod_auth_digest.so</span>
<span class="c1">#LoadModule allowmethods_module modules/mod_allowmethods.so</span>
<span class="c1">#LoadModule isapi_module modules/mod_isapi.so</span>
<span class="c1">#LoadModule file_cache_module modules/mod_file_cache.so</span>
<span class="c1">#LoadModule cache_module modules/mod_cache.so</span>
<span class="c1">#LoadModule cache_disk_module modules/mod_cache_disk.so</span>
<span class="c1">#LoadModule cache_socache_module modules/mod_cache_socache.so</span>
<span class="c1">#LoadModule socache_shmcb_module modules/mod_socache_shmcb.so</span>
<span class="c1">#LoadModule socache_dbm_module modules/mod_socache_dbm.so</span>
<span class="c1">#LoadModule socache_memcache_module modules/mod_socache_memcache.so</span>
<span class="c1">#LoadModule socache_redis_module modules/mod_socache_redis.so</span>
<span class="c1">#LoadModule watchdog_module modules/mod_watchdog.so</span>
<span class="c1">#LoadModule macro_module modules/mod_macro.so</span>
<span class="c1">#LoadModule dbd_module modules/mod_dbd.so</span>
<span class="c1">#LoadModule bucketeer_module modules/mod_bucketeer.so</span>
<span class="c1">#LoadModule dumpio_module modules/mod_dumpio.so</span>
<span class="c1">#LoadModule echo_module modules/mod_echo.so</span>
<span class="c1">#LoadModule example_hooks_module modules/mod_example_hooks.so</span>
<span class="c1">#LoadModule case_filter_module modules/mod_case_filter.so</span>
<span class="c1">#LoadModule case_filter_in_module modules/mod_case_filter_in.so</span>
<span class="c1">#LoadModule example_ipc_module modules/mod_example_ipc.so</span>
<span class="c1">#LoadModule buffer_module modules/mod_buffer.so</span>
<span class="c1">#LoadModule data_module modules/mod_data.so</span>
<span class="c1">#LoadModule ratelimit_module modules/mod_ratelimit.so</span>
LoadModule<span class="w"> </span>reqtimeout_module<span class="w"> </span>modules/mod_reqtimeout.so
<span class="c1">#LoadModule ext_filter_module modules/mod_ext_filter.so</span>
<span class="c1">#LoadModule request_module modules/mod_request.so</span>
<span class="c1">#LoadModule include_module modules/mod_include.so</span>
LoadModule<span class="w"> </span>filter_module<span class="w"> </span>modules/mod_filter.so
<span class="c1">#LoadModule reflector_module modules/mod_reflector.so</span>
<span class="c1">#LoadModule substitute_module modules/mod_substitute.so</span>
<span class="c1">#LoadModule sed_module modules/mod_sed.so</span>
<span class="c1">#LoadModule charset_lite_module modules/mod_charset_lite.so</span>
<span class="c1">#LoadModule deflate_module modules/mod_deflate.so</span>
<span class="c1">#LoadModule xml2enc_module modules/mod_xml2enc.so</span>
<span class="c1">#LoadModule proxy_html_module modules/mod_proxy_html.so</span>
<span class="c1">#LoadModule brotli_module modules/mod_brotli.so</span>
LoadModule<span class="w"> </span>mime_module<span class="w"> </span>modules/mod_mime.so
<span class="c1">#LoadModule ldap_module modules/mod_ldap.so</span>
LoadModule<span class="w"> </span>log_config_module<span class="w"> </span>modules/mod_log_config.so
<span class="c1">#LoadModule log_debug_module modules/mod_log_debug.so</span>
<span class="c1">#LoadModule log_forensic_module modules/mod_log_forensic.so</span>
<span class="c1">#LoadModule logio_module modules/mod_logio.so</span>
<span class="c1">#LoadModule lua_module modules/mod_lua.so</span>
LoadModule<span class="w"> </span>env_module<span class="w"> </span>modules/mod_env.so
<span class="c1">#LoadModule mime_magic_module modules/mod_mime_magic.so</span>
<span class="c1">#LoadModule cern_meta_module modules/mod_cern_meta.so</span>
<span class="c1">#LoadModule expires_module modules/mod_expires.so</span>
LoadModule<span class="w"> </span>headers_module<span class="w"> </span>modules/mod_headers.so
<span class="c1">#LoadModule ident_module modules/mod_ident.so</span>
<span class="c1">#LoadModule usertrack_module modules/mod_usertrack.so</span>
<span class="c1">#LoadModule unique_id_module modules/mod_unique_id.so</span>
LoadModule<span class="w"> </span>setenvif_module<span class="w"> </span>modules/mod_setenvif.so
LoadModule<span class="w"> </span>version_module<span class="w"> </span>modules/mod_version.so
<span class="c1">#LoadModule remoteip_module modules/mod_remoteip.so</span>
<span class="c1">#LoadModule proxy_module modules/mod_proxy.so</span>
<span class="c1">#LoadModule proxy_connect_module modules/mod_proxy_connect.so</span>
<span class="c1">#LoadModule proxy_ftp_module modules/mod_proxy_ftp.so</span>
<span class="c1">#LoadModule proxy_http_module modules/mod_proxy_http.so</span>
<span class="c1">#LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so</span>
<span class="c1">#LoadModule proxy_scgi_module modules/mod_proxy_scgi.so</span>
<span class="c1">#LoadModule proxy_uwsgi_module modules/mod_proxy_uwsgi.so</span>
<span class="c1">#LoadModule proxy_fdpass_module modules/mod_proxy_fdpass.so</span>
<span class="c1">#LoadModule proxy_wstunnel_module modules/mod_proxy_wstunnel.so</span>
<span class="c1">#LoadModule proxy_ajp_module modules/mod_proxy_ajp.so</span>
<span class="c1">#LoadModule proxy_balancer_module modules/mod_proxy_balancer.so</span>
<span class="c1">#LoadModule proxy_express_module modules/mod_proxy_express.so</span>
<span class="c1">#LoadModule proxy_hcheck_module modules/mod_proxy_hcheck.so</span>
<span class="c1">#LoadModule session_module modules/mod_session.so</span>
<span class="c1">#LoadModule session_cookie_module modules/mod_session_cookie.so</span>
<span class="c1">#LoadModule session_crypto_module modules/mod_session_crypto.so</span>
<span class="c1">#LoadModule session_dbd_module modules/mod_session_dbd.so</span>
<span class="c1">#LoadModule slotmem_shm_module modules/mod_slotmem_shm.so</span>
<span class="c1">#LoadModule slotmem_plain_module modules/mod_slotmem_plain.so</span>
<span class="c1">#LoadModule ssl_module modules/mod_ssl.so</span>
<span class="c1">#LoadModule optional_hook_export_module modules/mod_optional_hook_export.so</span>
<span class="c1">#LoadModule optional_hook_import_module modules/mod_optional_hook_import.so</span>
<span class="c1">#LoadModule optional_fn_import_module modules/mod_optional_fn_import.so</span>
<span class="c1">#LoadModule optional_fn_export_module modules/mod_optional_fn_export.so</span>
<span class="c1">#LoadModule dialup_module modules/mod_dialup.so</span>
<span class="c1">#LoadModule http2_module modules/mod_http2.so</span>
<span class="c1">#LoadModule proxy_http2_module modules/mod_proxy_http2.so</span>
<span class="c1">#LoadModule md_module modules/mod_md.so</span>
<span class="c1">#LoadModule lbmethod_byrequests_module modules/mod_lbmethod_byrequests.so</span>
<span class="c1">#LoadModule lbmethod_bytraffic_module modules/mod_lbmethod_bytraffic.so</span>
<span class="c1">#LoadModule lbmethod_bybusyness_module modules/mod_lbmethod_bybusyness.so</span>
<span class="c1">#LoadModule lbmethod_heartbeat_module modules/mod_lbmethod_heartbeat.so</span>
LoadModule<span class="w"> </span>unixd_module<span class="w"> </span>modules/mod_unixd.so
<span class="c1">#LoadModule heartbeat_module modules/mod_heartbeat.so</span>
<span class="c1">#LoadModule heartmonitor_module modules/mod_heartmonitor.so</span>
<span class="c1">#LoadModule dav_module modules/mod_dav.so</span>
LoadModule<span class="w"> </span>status_module<span class="w"> </span>modules/mod_status.so
LoadModule<span class="w"> </span>autoindex_module<span class="w"> </span>modules/mod_autoindex.so
<span class="c1">#LoadModule asis_module modules/mod_asis.so</span>
<span class="c1">#LoadModule info_module modules/mod_info.so</span>
<span class="c1">#LoadModule suexec_module modules/mod_suexec.so</span>
&lt;IfModule<span class="w"> </span>!mpm_prefork_module&gt;
<span class="w">	</span><span class="c1">#LoadModule cgid_module modules/mod_cgid.so</span>
&lt;/IfModule&gt;
&lt;IfModule<span class="w"> </span>mpm_prefork_module&gt;
<span class="w">	</span><span class="c1">#LoadModule cgi_module modules/mod_cgi.so</span>
&lt;/IfModule&gt;
<span class="c1">#LoadModule dav_fs_module modules/mod_dav_fs.so</span>
<span class="c1">#LoadModule dav_lock_module modules/mod_dav_lock.so</span>
<span class="c1">#LoadModule vhost_alias_module modules/mod_vhost_alias.so</span>
<span class="c1">#LoadModule negotiation_module modules/mod_negotiation.so</span>
LoadModule<span class="w"> </span>dir_module<span class="w"> </span>modules/mod_dir.so
<span class="c1">#LoadModule imagemap_module modules/mod_imagemap.so</span>
<span class="c1">#LoadModule actions_module modules/mod_actions.so</span>
<span class="c1">#LoadModule speling_module modules/mod_speling.so</span>
<span class="c1">#LoadModule userdir_module modules/mod_userdir.so</span>
LoadModule<span class="w"> </span>alias_module<span class="w"> </span>modules/mod_alias.so
<span class="c1">#LoadModule rewrite_module modules/mod_rewrite.so</span>

&lt;IfModule<span class="w"> </span>unixd_module&gt;
<span class="c1">#</span>
<span class="c1"># If you wish httpd to run as a different user or group, you must run</span>
<span class="c1"># httpd as root initially and it will switch.  </span>
<span class="c1">#</span>
<span class="c1"># User/Group: The name (or #number) of the user/group to run httpd as.</span>
<span class="c1"># It is usually good practice to create a dedicated user and group for</span>
<span class="c1"># running httpd, as with most system services.</span>
<span class="c1">#</span>
User<span class="w"> </span>www-data
Group<span class="w"> </span>www-data

&lt;/IfModule&gt;

<span class="c1"># &#39;Main&#39; server configuration</span>
<span class="c1">#</span>
<span class="c1"># The directives in this section set up the values used by the &#39;main&#39;</span>
<span class="c1"># server, which responds to any requests that aren&#39;t handled by a</span>
<span class="c1"># &lt;VirtualHost&gt; definition.  These values also provide defaults for</span>
<span class="c1"># any &lt;VirtualHost&gt; containers you may define later in the file.</span>
<span class="c1">#</span>
<span class="c1"># All of these directives may appear inside &lt;VirtualHost&gt; containers,</span>
<span class="c1"># in which case these default settings will be overridden for the</span>
<span class="c1"># virtual host being defined.</span>
<span class="c1">#</span>

<span class="c1">#</span>
<span class="c1"># ServerAdmin: Your address, where problems with the server should be</span>
<span class="c1"># e-mailed.  This address appears on some server-generated pages, such</span>
<span class="c1"># as error documents.  e.g. admin@your-domain.com</span>
<span class="c1">#</span>
ServerAdmin<span class="w"> </span>you@example.com

<span class="c1">#</span>
<span class="c1"># ServerName gives the name and port that the server uses to identify itself.</span>
<span class="c1"># This can often be determined automatically, but we recommend you specify</span>
<span class="c1"># it explicitly to prevent problems during startup.</span>
<span class="c1">#</span>
<span class="c1"># If your host doesn&#39;t have a registered DNS name, enter its IP address here.</span>
<span class="c1">#</span>
<span class="c1">#ServerName www.example.com:80</span>

<span class="c1">#</span>
<span class="c1"># Deny access to the entirety of your server&#39;s filesystem. You must</span>
<span class="c1"># explicitly permit access to web content directories in other </span>
<span class="c1"># &lt;Directory&gt; blocks below.</span>
<span class="c1">#</span>
&lt;Directory<span class="w"> </span>/&gt;
<span class="w">    </span>AllowOverride<span class="w"> </span>none
<span class="w">    </span>Require<span class="w"> </span>all<span class="w"> </span>denied
&lt;/Directory&gt;

<span class="c1">#</span>
<span class="c1"># Note that from this point forward you must specifically allow</span>
<span class="c1"># particular features to be enabled - so if something&#39;s not working as</span>
<span class="c1"># you might expect, make sure that you have specifically enabled it</span>
<span class="c1"># below.</span>
<span class="c1">#</span>

<span class="c1">#</span>
<span class="c1"># DocumentRoot: The directory out of which you will serve your</span>
<span class="c1"># documents. By default, all requests are taken from this directory, but</span>
<span class="c1"># symbolic links and aliases may be used to point to other locations.</span>
<span class="c1">#</span>
DocumentRoot<span class="w"> </span><span class="s2">&quot;/usr/local/apache2/htdocs&quot;</span>
&lt;Directory<span class="w"> </span><span class="s2">&quot;/usr/local/apache2/htdocs&quot;</span>&gt;
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># Possible values for the Options directive are &quot;None&quot;, &quot;All&quot;,</span>
<span class="w">    </span><span class="c1"># or any combination of:</span>
<span class="w">    </span><span class="c1">#   Indexes Includes FollowSymLinks SymLinksifOwnerMatch ExecCGI MultiViews</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># Note that &quot;MultiViews&quot; must be named *explicitly* --- &quot;Options All&quot;</span>
<span class="w">    </span><span class="c1"># doesn&#39;t give it to you.</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># The Options directive is both complicated and important.  Please see</span>
<span class="w">    </span><span class="c1"># http://httpd.apache.org/docs/2.4/mod/core.html#options</span>
<span class="w">    </span><span class="c1"># for more information.</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span>Options<span class="w"> </span>Indexes<span class="w"> </span>FollowSymLinks

<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># AllowOverride controls what directives may be placed in .htaccess files.</span>
<span class="w">    </span><span class="c1"># It can be &quot;All&quot;, &quot;None&quot;, or any combination of the keywords:</span>
<span class="w">    </span><span class="c1">#   AllowOverride FileInfo AuthConfig Limit</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span>AllowOverride<span class="w"> </span>None

<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># Controls who can get stuff from this server.</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span>Require<span class="w"> </span>all<span class="w"> </span>granted
&lt;/Directory&gt;

<span class="c1">#</span>
<span class="c1"># DirectoryIndex: sets the file that Apache will serve if a directory</span>
<span class="c1"># is requested.</span>
<span class="c1">#</span>
&lt;IfModule<span class="w"> </span>dir_module&gt;
<span class="w">    </span>DirectoryIndex<span class="w"> </span>index.html
&lt;/IfModule&gt;

<span class="c1">#</span>
<span class="c1"># The following lines prevent .htaccess and .htpasswd files from being </span>
<span class="c1"># viewed by Web clients. </span>
<span class="c1">#</span>
&lt;Files<span class="w"> </span><span class="s2">&quot;.ht*&quot;</span>&gt;
<span class="w">    </span>Require<span class="w"> </span>all<span class="w"> </span>denied
&lt;/Files&gt;

<span class="c1">#</span>
<span class="c1"># ErrorLog: The location of the error log file.</span>
<span class="c1"># If you do not specify an ErrorLog directive within a &lt;VirtualHost&gt;</span>
<span class="c1"># container, error messages relating to that virtual host will be</span>
<span class="c1"># logged here.  If you *do* define an error logfile for a &lt;VirtualHost&gt;</span>
<span class="c1"># container, that host&#39;s errors will be logged there and not here.</span>
<span class="c1">#</span>
ErrorLog<span class="w"> </span>/proc/self/fd/2

<span class="c1">#</span>
<span class="c1"># LogLevel: Control the number of messages logged to the error_log.</span>
<span class="c1"># Possible values include: debug, info, notice, warn, error, crit,</span>
<span class="c1"># alert, emerg.</span>
<span class="c1">#</span>
LogLevel<span class="w"> </span>warn

&lt;IfModule<span class="w"> </span>log_config_module&gt;
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># The following directives define some format nicknames for use with</span>
<span class="w">    </span><span class="c1"># a CustomLog directive (see below).</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span>LogFormat<span class="w"> </span><span class="s2">&quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot;&quot;</span><span class="w"> </span>combined
<span class="w">    </span>LogFormat<span class="w"> </span><span class="s2">&quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b&quot;</span><span class="w"> </span>common

<span class="w">    </span>&lt;IfModule<span class="w"> </span>logio_module&gt;
<span class="w">      </span><span class="c1"># You need to enable mod_logio.c to use %I and %O</span>
<span class="w">      </span>LogFormat<span class="w"> </span><span class="s2">&quot;%h %l %u %t \&quot;%r\&quot; %&gt;s %b \&quot;%{Referer}i\&quot; \&quot;%{User-Agent}i\&quot; %I %O&quot;</span><span class="w"> </span>combinedio
<span class="w">    </span>&lt;/IfModule&gt;

<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># The location and format of the access logfile (Common Logfile Format).</span>
<span class="w">    </span><span class="c1"># If you do not define any access logfiles within a &lt;VirtualHost&gt;</span>
<span class="w">    </span><span class="c1"># container, they will be logged here.  Contrariwise, if you *do*</span>
<span class="w">    </span><span class="c1"># define per-&lt;VirtualHost&gt; access logfiles, transactions will be</span>
<span class="w">    </span><span class="c1"># logged therein and *not* in this file.</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span>CustomLog<span class="w"> </span>/proc/self/fd/1<span class="w"> </span>common

<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># If you prefer a logfile with access, agent, and referer information</span>
<span class="w">    </span><span class="c1"># (Combined Logfile Format) you can use the following directive.</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1">#CustomLog &quot;logs/access_log&quot; combined</span>
&lt;/IfModule&gt;

&lt;IfModule<span class="w"> </span>alias_module&gt;
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># Redirect: Allows you to tell clients about documents that used to </span>
<span class="w">    </span><span class="c1"># exist in your server&#39;s namespace, but do not anymore. The client </span>
<span class="w">    </span><span class="c1"># will make a new request for the document at its new location.</span>
<span class="w">    </span><span class="c1"># Example:</span>
<span class="w">    </span><span class="c1"># Redirect permanent /foo http://www.example.com/bar</span>

<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># Alias: Maps web paths into filesystem paths and is used to</span>
<span class="w">    </span><span class="c1"># access content that does not live under the DocumentRoot.</span>
<span class="w">    </span><span class="c1"># Example:</span>
<span class="w">    </span><span class="c1"># Alias /webpath /full/filesystem/path</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># If you include a trailing / on /webpath then the server will</span>
<span class="w">    </span><span class="c1"># require it to be present in the URL.  You will also likely</span>
<span class="w">    </span><span class="c1"># need to provide a &lt;Directory&gt; section to allow access to</span>
<span class="w">    </span><span class="c1"># the filesystem path.</span>

<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># ScriptAlias: This controls which directories contain server scripts. </span>
<span class="w">    </span><span class="c1"># ScriptAliases are essentially the same as Aliases, except that</span>
<span class="w">    </span><span class="c1"># documents in the target directory are treated as applications and</span>
<span class="w">    </span><span class="c1"># run by the server when requested rather than as documents sent to the</span>
<span class="w">    </span><span class="c1"># client.  The same rules about trailing &quot;/&quot; apply to ScriptAlias</span>
<span class="w">    </span><span class="c1"># directives as to Alias.</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span>ScriptAlias<span class="w"> </span>/cgi-bin/<span class="w"> </span><span class="s2">&quot;/usr/local/apache2/cgi-bin/&quot;</span>

&lt;/IfModule&gt;

&lt;IfModule<span class="w"> </span>cgid_module&gt;
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># ScriptSock: On threaded servers, designate the path to the UNIX</span>
<span class="w">    </span><span class="c1"># socket used to communicate with the CGI daemon of mod_cgid.</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1">#Scriptsock cgisock</span>
&lt;/IfModule&gt;

<span class="c1">#</span>
<span class="c1"># &quot;/usr/local/apache2/cgi-bin&quot; should be changed to whatever your ScriptAliased</span>
<span class="c1"># CGI directory exists, if you have that configured.</span>
<span class="c1">#</span>
&lt;Directory<span class="w"> </span><span class="s2">&quot;/usr/local/apache2/cgi-bin&quot;</span>&gt;
<span class="w">    </span>AllowOverride<span class="w"> </span>None
<span class="w">    </span>Options<span class="w"> </span>None
<span class="w">    </span>Require<span class="w"> </span>all<span class="w"> </span>granted
&lt;/Directory&gt;

&lt;IfModule<span class="w"> </span>headers_module&gt;
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># Avoid passing HTTP_PROXY environment to CGI&#39;s on this or any proxied</span>
<span class="w">    </span><span class="c1"># backend servers which have lingering &quot;httpoxy&quot; defects.</span>
<span class="w">    </span><span class="c1"># &#39;Proxy&#39; request header is undefined by the IETF, not listed by IANA</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span>RequestHeader<span class="w"> </span><span class="nb">unset</span><span class="w"> </span>Proxy<span class="w"> </span>early
&lt;/IfModule&gt;

&lt;IfModule<span class="w"> </span>mime_module&gt;
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># TypesConfig points to the file containing the list of mappings from</span>
<span class="w">    </span><span class="c1"># filename extension to MIME-type.</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span>TypesConfig<span class="w"> </span>conf/mime.types

<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># AddType allows you to add to or override the MIME configuration</span>
<span class="w">    </span><span class="c1"># file specified in TypesConfig for specific file types.</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1">#AddType application/x-gzip .tgz</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># AddEncoding allows you to have certain browsers uncompress</span>
<span class="w">    </span><span class="c1"># information on the fly. Note: Not all browsers support this.</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1">#AddEncoding x-compress .Z</span>
<span class="w">    </span><span class="c1">#AddEncoding x-gzip .gz .tgz</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># If the AddEncoding directives above are commented-out, then you</span>
<span class="w">    </span><span class="c1"># probably should define those extensions to indicate media types:</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span>AddType<span class="w"> </span>application/x-compress<span class="w"> </span>.Z
<span class="w">    </span>AddType<span class="w"> </span>application/x-gzip<span class="w"> </span>.gz<span class="w"> </span>.tgz

<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># AddHandler allows you to map certain file extensions to &quot;handlers&quot;:</span>
<span class="w">    </span><span class="c1"># actions unrelated to filetype. These can be either built into the server</span>
<span class="w">    </span><span class="c1"># or added with the Action directive (see below)</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># To use CGI scripts outside of ScriptAliased directories:</span>
<span class="w">    </span><span class="c1"># (You will also need to add &quot;ExecCGI&quot; to the &quot;Options&quot; directive.)</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1">#AddHandler cgi-script .cgi</span>

<span class="w">    </span><span class="c1"># For type maps (negotiated resources):</span>
<span class="w">    </span><span class="c1">#AddHandler type-map var</span>

<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># Filters allow you to process content before it is sent to the client.</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1"># To parse .shtml files for server-side includes (SSI):</span>
<span class="w">    </span><span class="c1"># (You will also need to add &quot;Includes&quot; to the &quot;Options&quot; directive.)</span>
<span class="w">    </span><span class="c1">#</span>
<span class="w">    </span><span class="c1">#AddType text/html .shtml</span>
<span class="w">    </span><span class="c1">#AddOutputFilter INCLUDES .shtml</span>
&lt;/IfModule&gt;

<span class="c1">#</span>
<span class="c1"># The mod_mime_magic module allows the server to use various hints from the</span>
<span class="c1"># contents of the file itself to determine its type.  The MIMEMagicFile</span>
<span class="c1"># directive tells the module where the hint definitions are located.</span>
<span class="c1">#</span>
<span class="c1">#MIMEMagicFile conf/magic</span>

<span class="c1">#</span>
<span class="c1"># Customizable error responses come in three flavors:</span>
<span class="c1"># 1) plain text 2) local redirects 3) external redirects</span>
<span class="c1">#</span>
<span class="c1"># Some examples:</span>
<span class="c1">#ErrorDocument 500 &quot;The server made a boo boo.&quot;</span>
<span class="c1">#ErrorDocument 404 /missing.html</span>
<span class="c1">#ErrorDocument 404 &quot;/cgi-bin/missing_handler.pl&quot;</span>
<span class="c1">#ErrorDocument 402 http://www.example.com/subscription_info.html</span>
<span class="c1">#</span>

<span class="c1">#</span>
<span class="c1"># MaxRanges: Maximum number of Ranges in a request before</span>
<span class="c1"># returning the entire resource, or one of the special</span>
<span class="c1"># values &#39;default&#39;, &#39;none&#39; or &#39;unlimited&#39;.</span>
<span class="c1"># Default setting is to accept 200 Ranges.</span>
<span class="c1">#MaxRanges unlimited</span>

<span class="c1">#</span>
<span class="c1"># EnableMMAP and EnableSendfile: On systems that support it, </span>
<span class="c1"># memory-mapping or the sendfile syscall may be used to deliver</span>
<span class="c1"># files.  This usually improves server performance, but must</span>
<span class="c1"># be turned off when serving from networked-mounted </span>
<span class="c1"># filesystems or if support for these functions is otherwise</span>
<span class="c1"># broken on your system.</span>
<span class="c1"># Defaults: EnableMMAP On, EnableSendfile Off</span>
<span class="c1">#</span>
<span class="c1">#EnableMMAP off</span>
<span class="c1">#EnableSendfile on</span>

<span class="c1"># Supplemental configuration</span>
<span class="c1">#</span>
<span class="c1"># The configuration files in the conf/extra/ directory can be </span>
<span class="c1"># included to add extra features or to modify the default configuration of </span>
<span class="c1"># the server, or you may simply copy their contents here and change as </span>
<span class="c1"># necessary.</span>

<span class="c1"># Server-pool management (MPM specific)</span>
<span class="c1">#Include conf/extra/httpd-mpm.conf</span>

<span class="c1"># Multi-language error messages</span>
<span class="c1">#Include conf/extra/httpd-multilang-errordoc.conf</span>

<span class="c1"># Fancy directory listings</span>
<span class="c1">#Include conf/extra/httpd-autoindex.conf</span>

<span class="c1"># Language settings</span>
<span class="c1">#Include conf/extra/httpd-languages.conf</span>

<span class="c1"># User home directories</span>
<span class="c1">#Include conf/extra/httpd-userdir.conf</span>

<span class="c1"># Real-time info on requests and configuration</span>
<span class="c1">#Include conf/extra/httpd-info.conf</span>

<span class="c1"># Virtual hosts</span>
<span class="c1">#Include conf/extra/httpd-vhosts.conf</span>

<span class="c1"># Local access to the Apache HTTP Server Manual</span>
<span class="c1">#Include conf/extra/httpd-manual.conf</span>

<span class="c1"># Distributed authoring and versioning (WebDAV)</span>
<span class="c1">#Include conf/extra/httpd-dav.conf</span>

<span class="c1"># Various default settings</span>
<span class="c1">#Include conf/extra/httpd-default.conf</span>

<span class="c1"># Configure mod_proxy_html to understand HTML4/XHTML1</span>
&lt;IfModule<span class="w"> </span>proxy_html_module&gt;
Include<span class="w"> </span>conf/extra/proxy-html.conf
&lt;/IfModule&gt;

<span class="c1"># Secure (SSL/TLS) connections</span>
<span class="c1">#Include conf/extra/httpd-ssl.conf</span>
<span class="c1">#</span>
<span class="c1"># Note: The following must must be present to support</span>
<span class="c1">#       starting without SSL on platforms with no /dev/random equivalent</span>
<span class="c1">#       but a statically compiled-in mod_ssl.</span>
<span class="c1">#</span>
&lt;IfModule<span class="w"> </span>ssl_module&gt;
SSLRandomSeed<span class="w"> </span>startup<span class="w"> </span><span class="nb">builtin</span>
SSLRandomSeed<span class="w"> </span>connect<span class="w"> </span><span class="nb">builtin</span>
&lt;/IfModule&gt;
<span class="s1">&#39;&#39;</span><span class="err">&#39;</span>


<span class="c1">#启动容器</span>
sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-itd<span class="w"> </span>--name<span class="w"> </span>httpd-default<span class="w"> </span>-p<span class="w"> </span><span class="m">8234</span>:80<span class="w"> </span>--restart<span class="o">=</span>always<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu/docker/httpd-default/htdocs:/usr/local/apache2/htdocs<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu/docker/httpd-default/conf/httpd.conf:/usr/local/apache2/conf/httpd.conf<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu/docker/httpd-default/logs:/usr/local/apache2/logs<span class="w"> </span>httpd
<span class="c1">#sudo docker run -itd --name httpd-default -p 8234:80 --restart=always -v /home/ubuntu/docker/httpd-default/htdocs:/usr/local/apache2/htdocs -v /home/ubuntu/docker/httpd-default/conf:/usr/local/apache2/conf -v /home/ubuntu/docker/httpd-default/logs:/usr/local/apache2/logs httpd</span>
</pre></div>
</div>
</section>
<section id="id9">
<h2>配置命令<a class="headerlink" href="#id9" title="Link to this heading">¶</a></h2>
<p>进入容器</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>httpd-default<span class="w"> </span>/bin/bash
</pre></div>
</div>
<section id="id10">
<h3>修改中文显示<a class="headerlink" href="#id10" title="Link to this heading">¶</a></h3>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#首先更新apt源</span>
apt-get<span class="w"> </span>update
<span class="c1">#安装文本编辑器vim</span>
apt-get<span class="w"> </span>install<span class="w"> </span>vim
<span class="c1">#切换到conf目录</span>
<span class="nb">cd</span><span class="w"> </span>./conf
<span class="c1">#修改httpd.conf配置文件，在末尾添加`IndexOptions Charset=UTF-8`</span>
<span class="c1">#先备份</span>
cp<span class="w"> </span>./httpd.conf<span class="w"> </span>./httpd.conf.BAK
vi<span class="w"> </span>./httpd.conf
<span class="c1">#按`i`进入编辑模式</span>
<span class="c1">#在文件末尾插入以下内容</span>
<span class="s1">&#39;</span>
<span class="s1">IndexOptions Charset=UTF-8</span>
<span class="s1">&#39;</span>
<span class="c1">#修改完毕后按ESC退出编辑模式，按`:`，输入`wq`后回车，保存退出</span>
<span class="c1">#退出容器</span>
<span class="nb">exit</span>
<span class="c1">#重启容器生效</span>
sudo<span class="w"> </span>docker<span class="w"> </span>restart<span class="w"> </span>httpd-default
</pre></div>
</div>
</section>
<section id="id11">
<h3>设置需要密码访问<a class="headerlink" href="#id11" title="Link to this heading">¶</a></h3>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#修改Apache的配置文件/usr/local/apache2/conf/httpd.conf，对需要认证的资源所在的目录进行配置</span>
<span class="nb">cd</span><span class="w"> </span>./conf
<span class="c1">#修改httpd.conf配置文件，在末尾添加``</span>
<span class="c1">#先备份</span>
cp<span class="w"> </span>./httpd.conf<span class="w"> </span>./httpd.conf.BAK
vi<span class="w"> </span>./httpd.conf
<span class="c1">#按`i`进入编辑模式，然后修改文件目录对应的&lt;Directory&gt;，此处以`htdocs`根目录为例</span>
<span class="c1">#修改Apache的配置文件/usr/local/apache2/conf/httpd.conf，对需要认证的资源所在的目录进行配置</span>
<span class="s1">&#39;</span>
<span class="s1">&lt;Directory &quot;/usr/local/apache2/htdocs&quot;&gt;  #网站根目录</span>
<span class="s1">    Options Indexes MultiViews</span>
<span class="s1">    AllowOverride AuthConfig</span>
<span class="s1">    Order allow,deny</span>
<span class="s1">    Allow from all</span>
<span class="s1">&lt;/Directory&gt;</span>
<span class="s1">&#39;</span>
<span class="c1">#修改完毕后按ESC退出编辑模式，按`:`，输入`wq`后回车，保存退出</span>
<span class="c1">#在限制访问目录/usr/local/apache2/htdocs/下创建文件.htaccess，修改文件内容</span>
<span class="nb">cd</span><span class="w"> </span>..
<span class="nb">cd</span><span class="w"> </span>./htdocs
vi<span class="w"> </span>.htaccess
<span class="c1">#按`i`进入编辑模式，然后修改文件目录对应的&lt;Directory&gt;，此处以`htdocs`根目录为例</span>
<span class="s1">&#39;</span>
<span class="s1">AuthName &quot;sys&quot;</span>
<span class="s1">AuthType Basic</span>
<span class="s1">AuthUserFile /usr/local/apache2/htdocs/.htpasswd</span>
<span class="s1">require user admin</span>
<span class="s1">&#39;</span>
<span class="c1">#修改完毕后按ESC退出编辑模式，按`:`，输入`wq`后回车，保存退出</span>
<span class="c1">#利用Apache附带的程序htpasswd，生成包含用户名和密码的文本文件：/var/www/html/.htpasswd</span>
htpasswd<span class="w"> </span>-c<span class="w"> </span>/usr/local/apache2/htdocs/.htpasswd<span class="w"> </span>admin
<span class="c1">#若使用映射到主机的目录，则为： htpasswd -c /home/ubuntu/docker/httpd-default/htdocs/.htpasswd admin</span>
<span class="c1">#输入密码</span>
<span class="c1"># 或：/usr/local/apache2/bin/htpasswd -c /usr/local/apache2/htdocs/.htpasswd admin</span>
<span class="c1">#退出容器</span>
<span class="nb">exit</span>
<span class="c1">#重启容器生效</span>
sudo<span class="w"> </span>docker<span class="w"> </span>restart<span class="w"> </span>httpd-default
</pre></div>
</div>
</section>
<section id="id12">
<h3>自定义404等页面<a class="headerlink" href="#id12" title="Link to this heading">¶</a></h3>
<p>httpd.conf中：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># Customizable error responses come in three flavors:</span>
<span class="c1"># 1) plain text 2) local redirects 3) external redirects</span>
<span class="c1">#</span>
<span class="c1"># Some examples:</span>
<span class="c1">#ErrorDocument 500 &quot;The server made a boo boo.&quot;</span>
<span class="c1">#ErrorDocument 404 /missing.html</span>
<span class="c1">#ErrorDocument 404 &quot;/cgi-bin/missing_handler.pl&quot;</span>
<span class="c1">#ErrorDocument 402 http://www.example.com/subscription_info.html</span>
<span class="c1">#</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ErrorDocument<span class="w"> </span><span class="m">400</span><span class="w"> </span>/error_pages/400.html
ErrorDocument<span class="w"> </span><span class="m">401</span><span class="w"> </span>/error_pages/401.html
ErrorDocument<span class="w"> </span><span class="m">403</span><span class="w"> </span>/error_pages/403.html
ErrorDocument<span class="w"> </span><span class="m">404</span><span class="w"> </span>/error_pages/404.html
ErrorDocument<span class="w"> </span><span class="m">500</span><span class="w"> </span>/error_pages/500.html
</pre></div>
</div>
</section>
</section>
</section>
<section id="navidrome">
<h1>navidrome自建音乐播放器<a class="headerlink" href="#navidrome" title="Link to this heading">¶</a></h1>
<p>先拉取镜像：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#latest version</span>
sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>deluan/navidrome:latest


<span class="c1">#custom version, e.g.pr-2818</span>
sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>deluan/navidrome:pr-2818
</pre></div>
</div>
<p>创建并运行容器（自定义音乐所在目录和数据目录）：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#latest version</span>
sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-itd<span class="w"> </span>--name<span class="w"> </span>navidrome-default<span class="w"> </span>-v<span class="w"> </span>/mnt/toshiba/docker/httpd-default/htdocs:/music<span class="w"> </span>-v<span class="w"> </span>/mnt/toshiba/docker/navidrome-default:/data<span class="w"> </span>--restart<span class="o">=</span>unless-stopped<span class="w"> </span>--user<span class="w"> </span><span class="k">$(</span>id<span class="w"> </span>-u<span class="k">)</span>:<span class="k">$(</span>id<span class="w"> </span>-g<span class="k">)</span><span class="w"> </span>-p<span class="w"> </span><span class="m">8236</span>:4533<span class="w"> </span>-e<span class="w"> </span><span class="nv">ND_LOGLEVEL</span><span class="o">=</span>info<span class="w"> </span>deluan/navidrome:latest


<span class="c1">#custom version, e.g.pr-2818</span>
sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-itd<span class="w"> </span>--name<span class="w"> </span>navidrome-default<span class="w"> </span>-v<span class="w"> </span>/mnt/toshiba/docker/httpd-default/htdocs:/music<span class="w"> </span>-v<span class="w"> </span>/mnt/toshiba/docker/navidrome-default:/data<span class="w"> </span>--restart<span class="o">=</span>unless-stopped<span class="w"> </span>--user<span class="w"> </span><span class="k">$(</span>id<span class="w"> </span>-u<span class="k">)</span>:<span class="k">$(</span>id<span class="w"> </span>-g<span class="k">)</span><span class="w"> </span>-p<span class="w"> </span><span class="m">8236</span>:4533<span class="w"> </span>-e<span class="w"> </span><span class="nv">ND_LOGLEVEL</span><span class="o">=</span>info<span class="w"> </span>deluan/navidrome:pr-2818
</pre></div>
</div>
</section>
<section id="jellyfin">
<h1>jellyfin<a class="headerlink" href="#jellyfin" title="Link to this heading">¶</a></h1>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/jellyfin-default/library
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/jellyfin-default/tvseries
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/jellyfin-default/movies

sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="o">=</span>jellyfin-default<span class="w"> </span>-e<span class="w"> </span><span class="nv">PUID</span><span class="o">=</span><span class="m">1000</span><span class="w"> </span>-e<span class="w"> </span><span class="nv">PGID</span><span class="o">=</span><span class="m">1000</span><span class="w"> </span>-e<span class="w"> </span><span class="nv">TZ</span><span class="o">=</span>Etc/UTC<span class="w"> </span>-p<span class="w"> </span><span class="m">8096</span>:8096<span class="w"> </span>-p<span class="w"> </span><span class="m">8920</span>:8920<span class="w"> </span>-p<span class="w"> </span><span class="m">7359</span>:7359<span class="w">  </span>-p<span class="w"> </span><span class="m">1900</span>:1900<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu/docker/jellyfin-default/library:/config<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu:/data/tvshows<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu:/data/movies<span class="w"> </span>-v<span class="w"> </span>/:/data/root<span class="w"> </span>--restart<span class="w"> </span>unless-stopped<span class="w">  </span>linuxserver/jellyfin:10.9.10

<span class="c1">#sudo docker run -d --name=jellyfin-default -e PUID=1000 -e PGID=1000 -e TZ=Etc/UTC -p 8096:8096 -p 8920:8920 -p 7359:7359  -p 1900:1900 -v /home/ubuntu/docker/jellyfin-default/library:/config -v /home/ubuntu/docker/jellyfin-default/tvseries:/data/tvshows -v /home/ubuntu/docker/jellyfin-default/movies:/data/movies --restart unless-stopped  lscr.io/linuxserver/jellyfin:10.9.10</span>
</pre></div>
</div>
</section>
<section id="kodexplorer">
<h1>kodexplorer<a class="headerlink" href="#kodexplorer" title="Link to this heading">¶</a></h1>
<section id="id13">
<h2>1.快速启动<a class="headerlink" href="#id13" title="Link to this heading">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">80</span>:80<span class="w"> </span>kodcloud/kodexplorer
</pre></div>
</div>
</section>
<section id="id14">
<h2>2.实现数据持久化——创建数据目录并在启动时挂载<a class="headerlink" href="#id14" title="Link to this heading">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>/data
docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">80</span>:80<span class="w"> </span>-v<span class="w"> </span>/data:/var/www/html<span class="w"> </span>kodcloud/kodexplorer
</pre></div>
</div>
<p>thinServer的部署代码：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/mnt/toshiba
mkdir<span class="w"> </span>kodexplorer-default

sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>kodcloud/kodexplorer:4.52

sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-itd<span class="w"> </span>--name<span class="w"> </span>kodexplorer-default<span class="w"> </span>--restart<span class="o">=</span>always<span class="w"> </span>-v<span class="w"> </span>/mnt/toshiba/docker/kodexplorer-default:/var/www/html<span class="w"> </span>-p<span class="w"> </span><span class="m">8237</span>:80<span class="w"> </span>kodcloud/kodexplorer:4.52
</pre></div>
</div>
</section>
</section>
<section id="nextcloud">
<h1>nextcloud部署<a class="headerlink" href="#nextcloud" title="Link to this heading">¶</a></h1>
<section id="id15">
<h2>部署命令<a class="headerlink" href="#id15" title="Link to this heading">¶</a></h2>
<p>拉取镜像</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>nextcloud
</pre></div>
</div>
<p>创建对应的mysql5.7容器，并配置数据库、创建管理员账户</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#拉取mysql5.7镜像</span>
sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>mysql:5.7
<span class="c1">#运行mysql5.7镜像</span>
sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>--name<span class="o">=</span>mysql5-default<span class="w"> </span>-e<span class="w"> </span><span class="nv">MYSQL_ROOT_PASSWORD</span><span class="o">=</span><span class="m">123456</span><span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">3306</span>:3306<span class="w"> </span>--restart<span class="o">=</span>always<span class="w"> </span>mysql:5.7
<span class="c1">#创建nextcloud_db数据库</span>
sudo<span class="w"> </span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>mysql5-default<span class="w"> </span>mysql<span class="w"> </span>-u<span class="w"> </span>root<span class="w"> </span>-p
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">nextcloud</span><span class="p">;</span>
<span class="k">GRANT</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;root&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span>
<span class="n">flush</span><span class="w"> </span><span class="k">privileges</span><span class="p">;</span>
<span class="n">exit</span><span class="p">;</span>
</pre></div>
</div>
<p>运行</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#创建映射目录</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/nextcloud-default/nextcloud/html
<span class="c1">#启动容器</span>
sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-itd<span class="w"> </span>--restart<span class="w"> </span>always<span class="w"> </span>--name<span class="w"> </span>nextcloud-default<span class="w"> </span>--link<span class="w"> </span>mysql5-default:db<span class="w"> </span>-p<span class="w"> </span><span class="m">8235</span>:80<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu/docker/nextcloud-default/nextcloud/html:/var/www/html<span class="w"> </span>nextcloud
</pre></div>
</div>
<p>运行后，配置时数据库名可任意（最好写和上述匹配的mysql5-default），主机名称和端口号写db。</p>
</section>
<section id="nextcloud-0770">
<h2><strong>错误：nextcloud 您的数据目录可被其他用户读取 请更改权限为 0770 以避免其他用户查看目录</strong><a class="headerlink" href="#nextcloud-0770" title="Link to this heading">¶</a></h2>
<p>解决办法：config.php 添加 ‘check_data_directory_permissions’ =&gt; false</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">&#39;check_data_directory_permissions&#39; =&gt; false</span>
</pre></div>
</div>
</section>
<section id="nextcloud-ip-ip">
<h2>Nextcloud 通过不被信任的域名访问 动态IP解决方案，允许所有IP访问<a class="headerlink" href="#nextcloud-ip-ip" title="Link to this heading">¶</a></h2>
<p>解决方法：</p>
<p>打开 /config/config.php</p>
<p>找到 trusted_domains</p>
<p>增加一项</p>
<p><code class="docutils literal notranslate"><span class="pre">preg_match('/cli/i',php_sapi_name())?'127.0.0.1':$_SERVER['SERVER_NAME']</span></code></p>
<p>完整的代码</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">//索引数字顺延就可以</span>
<span class="x">&#39;trusted_domains&#39; =&gt; array(</span>
<span class="x">        0 =&gt; &#39;127.0.0.1&#39;,</span>
<span class="x">        1 =&gt; preg_match(&#39;/cli/i&#39;,php_sapi_name())?&#39;127.0.0.1&#39;:$_SERVER[&#39;SERVER_NAME&#39;],</span>
<span class="x">),</span>
</pre></div>
</div>
<p>解释：$_SERVER[‘SERVER_NAME’] 为获得当前访问的域名或IP，最初只设置了server_name，后来在查看cron任务时，发现在cli模式下是无法获得的，所以增加了cli模式判断，cli模式直接给个本地IP忽悠程序，正常模式将当前访问的域名或IP动态的添加的信任的域名中。</p>
</section>
</section>
<section id="onlyoffice">
<h1>onlyoffice部署<a class="headerlink" href="#onlyoffice" title="Link to this heading">¶</a></h1>
<section id="id16">
<h2>部署命令<a class="headerlink" href="#id16" title="Link to this heading">¶</a></h2>
<p>拉取镜像</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>onlyoffice/documentserver
</pre></div>
</div>
<p>运行</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="c1">#创建映射目录</span>
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/onlyoffice-default/log
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/onlyoffice-default/data
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/onlyoffice-default/lib
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/onlyoffice-default/db
<span class="c1">#启动容器</span>
sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-i<span class="w"> </span>-t<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">8236</span>:80<span class="w"> </span>--name<span class="w"> </span>onlyoffice-default<span class="w"> </span>--restart<span class="o">=</span>always<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu/docker/onlyoffice-default/log:/var/log/onlyoffice<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu/docker/onlyoffice-default/data:/var/www/onlyoffice/Data<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu/docker/onlyoffice-default/lib:/var/lib/onlyoffice<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu/docker/onlyoffice-default/db:/var/lib/postgresql<span class="w">  </span>onlyoffice/documentserver
</pre></div>
</div>
</section>
<section id="id17">
<h2>配置命令<a class="headerlink" href="#id17" title="Link to this heading">¶</a></h2>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>onlyoffice-default<span class="w"> </span>/bin/bash
</pre></div>
</div>
</section>
<section id="nextcloudonlyoffice">
<h2>nextcloud与onlyoffice链接<a class="headerlink" href="#nextcloudonlyoffice" title="Link to this heading">¶</a></h2>
<p>在应用中下载onlyoffice，如果显示链接超时错误，进入目录/home/<a class="reference external" href="https://so.csdn.net/so/search?q=docker&amp;spm=1001.2101.3001.7020">docker</a>/nextcloud/config，打开config.php文件，在末尾加入内容：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">&#39;appstoreenabled&#39; =&gt; true,</span>
<span class="x">&#39;appstoreurl&#39; =&gt; &#39;https://www.orcy.net/ncapps/v1/&#39;,</span>
</pre></div>
</div>
<p>在nextcloud的设置中找到ONLYOFFICE，修改相应设置。</p>
<p>如果显示无法连接，则在config.php末尾加上：</p>
<div class="highlight-php notranslate"><div class="highlight"><pre><span></span><span class="x">&#39;allow_local_remote_servers&#39; =&gt; true,</span>
</pre></div>
</div>
</section>
</section>
<section id="jupyter-base-notebook">
<h1>jupyter/base-notebook配置<a class="headerlink" href="#jupyter-base-notebook" title="Link to this heading">¶</a></h1>
<section id="id18">
<h2>镜像拉取<a class="headerlink" href="#id18" title="Link to this heading">¶</a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>jupyter/base-notebook
</pre></div>
</div>
</section>
<section id="id19">
<h2>创建容器<a class="headerlink" href="#id19" title="Link to this heading">¶</a></h2>
<p>首先创建一个测试容器，用于生成jupyter-notebook的登陆密码：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1">#在启动时携带--rm选项表示退出容器时会自动将其删除</span>
sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>--rm<span class="w"> </span>-p<span class="w"> </span><span class="m">8765</span>:8888<span class="w"> </span>jupyter/base-notebook
<span class="c1">#在启动时携带--rm选项表示退出容器时会自动将其删除</span>
</pre></div>
</div>
<p>设置密码：</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">notebook.auth</span> <span class="kn">import</span> <span class="n">passwd</span>
<span class="n">passwd</span><span class="p">()</span>
<span class="c1">#输入密码，输入确认密码后，生成序列</span>
</pre></div>
</div>
<p>此处使用了–rm参数，退出容器时会自动将其删除。</p>
<p>然后修改NotebookApp.password为上一步生成的序列，先创建对应工作目录并设置目录权限，然后创建容器：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/jupyter-base-notebook-default
sudo<span class="w"> </span>chown<span class="w"> </span>ubuntu<span class="w"> </span>/home/ubuntu/docker/jupyter-base-notebook-default
sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">777</span><span class="w"> </span>/home/ubuntu/docker/jupyter-base-notebook-default/
sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-itd<span class="w"> </span>--user<span class="w"> </span>root<span class="w"> </span>-p<span class="w"> </span><span class="m">9003</span>:8888<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu/docker/jupyter-base-notebook-default:/home/jovyan/work<span class="w"> </span>--name<span class="w"> </span>jupyter-base-notebook-default<span class="w"> </span>jupyter/base-notebook<span class="w"> </span>start-notebook.sh<span class="w"> </span>--NotebookApp.password<span class="o">=</span><span class="s1">&#39;argon2:$argon2id$v=19$m=10240,t=10,p=8$jrgM8WxzlfpOvvvsMnSikg$cZWW4J5Vxan2cUDvkguw4ZWQ7rnnTqPqKVR9XEEeoSY&#39;</span><span class="w"> </span>--NotebookApp.allow_password_change<span class="o">=</span>False<span class="w"> </span>--NotebookApp.allow_remote_access<span class="o">=</span>True<span class="w"> </span>--NotebookApp.open_browser<span class="o">=</span>False<span class="w"> </span>--NotebookApp.notebook_dir<span class="o">=</span><span class="s2">&quot;/home/jovyan/work&quot;</span>
<span class="c1">#此命令中密码为abcd1234</span>
</pre></div>
</div>
<p>以下是映射到端口8765，默认密码a0b0c1d2：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/jupyter-base-notebook-default
sudo<span class="w"> </span>chown<span class="w"> </span>ubuntu<span class="w"> </span>/home/ubuntu/docker/jupyter-base-notebook-default
sudo<span class="w"> </span>chmod<span class="w"> </span><span class="m">777</span><span class="w"> </span>/home/ubuntu/docker/jupyter-base-notebook-default/
sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-itd<span class="w"> </span>--user<span class="w"> </span>root<span class="w"> </span>-p<span class="w"> </span><span class="m">8765</span>:8888<span class="w"> </span>-v<span class="w"> </span>/home/ubuntu/docker/jupyter-base-notebook-default:/home/jovyan/work<span class="w"> </span>--name<span class="w"> </span>jupyter-base-notebook-default<span class="w"> </span>jupyter/base-notebook<span class="w"> </span>start-notebook.sh<span class="w"> </span>--NotebookApp.password<span class="o">=</span><span class="s1">&#39;argon2:$argon2id$v=19$m=10240,t=10,p=8$5yg+H3DM01xG9iGx0fmAdw$0nxMo9IEY9z0WSf/hNcjdpDOwRQhZcAdq/UymeSzJOA&#39;</span><span class="w"> </span>--NotebookApp.allow_password_change<span class="o">=</span>False<span class="w"> </span>--NotebookApp.allow_remote_access<span class="o">=</span>True<span class="w"> </span>--NotebookApp.open_browser<span class="o">=</span>False<span class="w"> </span>--NotebookApp.notebook_dir<span class="o">=</span><span class="s2">&quot;/home/jovyan/work&quot;</span>
</pre></div>
</div>
</section>
<section id="id20">
<h2>修改中文<a class="headerlink" href="#id20" title="Link to this heading">¶</a></h2>
<p>若需修改语言为中文，请使用pip安装此包，然后在Settings-Language中切换语言为中文即可：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip<span class="w"> </span>install<span class="w"> </span>jupyterlab-language-pack-zh-CN
</pre></div>
</div>
</section>
</section>
<section id="rtmp">
<h1>rtmp<a class="headerlink" href="#rtmp" title="Link to this heading">¶</a></h1>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>alqutami/rtmp-hls
sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p<span class="w"> </span><span class="m">11935</span>:1935<span class="w"> </span>-p<span class="w"> </span><span class="m">18080</span>:8080<span class="w"> </span>alqutami/rtmp-hls
</pre></div>
</div>
<section id="to-stream-to-the-server">
<h2>To stream to the server<a class="headerlink" href="#to-stream-to-the-server" title="Link to this heading">¶</a></h2>
<ul>
<li><p><strong>Stream live RTMP content to:</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rtmp</span><span class="p">:</span><span class="o">//&lt;</span><span class="n">server</span> <span class="n">ip</span><span class="o">&gt;</span><span class="p">:</span><span class="mi">1935</span><span class="o">/</span><span class="n">live</span><span class="o">/&lt;</span><span class="n">stream_key</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">&lt;stream_key&gt;</span></code> is any stream key you specify.</p>
</li>
<li><p><strong>Configure <a class="reference external" href="https://obsproject.com/">OBS</a> to stream content:</strong>
Go to Settings &gt; Stream, choose the following settings:</p>
<ul class="simple">
<li><p>Service: Custom Streaming Server.</p></li>
<li><p>Server: <code class="docutils literal notranslate"><span class="pre">rtmp://&lt;server</span> <span class="pre">ip&gt;:1935/live</span></code>.</p></li>
<li><p>Stream key: anything you want, however provided video players assume stream key is <code class="docutils literal notranslate"><span class="pre">test</span></code></p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="calibre-web">
<h1>calibre-web部署<a class="headerlink" href="#calibre-web" title="Link to this heading">¶</a></h1>
<p>初次启动时的 <a class="reference external" href="./File/metadata.db">metadata.db</a> 在File目录中。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>linuxserver/calibre-web:0.6.21
</pre></div>
</div>
<p><strong>docker-compose (recommended, <a class="reference external" href="https://docs.linuxserver.io/general/docker-compose">click here for more info</a>)</strong></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nn">---</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">calibre-web</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">lscr.io/linuxserver/calibre-web:latest</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">calibre-web</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PUID=1000</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PGID=1000</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TZ=Etc/UTC</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DOCKER_MODS=linuxserver/mods:universal-calibre</span><span class="w"> </span><span class="c1">#optional</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OAUTHLIB_RELAX_TOKEN_SCOPE=1</span><span class="w"> </span><span class="c1">#optional</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/data:/config</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/path/to/calibre/library:/books</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8083:8083</span>
<span class="w">    </span><span class="nt">restart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">unless-stopped</span>
</pre></div>
</div>
<p><strong>docker cli (<a class="reference external" href="https://docs.docker.com/engine/reference/commandline/cli/">click here for more info</a>)</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/mnt/toshiba/docker/calibre-web-default/data
sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/mnt/toshiba/docker/calibre-web-default/library
sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="o">=</span>calibre-web-default<span class="w"> </span>-e<span class="w"> </span><span class="nv">PUID</span><span class="o">=</span><span class="m">1000</span><span class="w"> </span>-e<span class="w"> </span><span class="nv">PGID</span><span class="o">=</span><span class="m">1000</span><span class="w"> </span>-e<span class="w"> </span><span class="nv">TZ</span><span class="o">=</span>Etc/UTC<span class="w"> </span>-e<span class="w"> </span><span class="nv">DOCKER_MODS</span><span class="o">=</span>linuxserver/mods:universal-calibre<span class="w"> </span><span class="sb">`</span><span class="c1">#optional` -e OAUTHLIB_RELAX_TOKEN_SCOPE=1 `#optional` -p 8239:8083 -v /mnt/toshiba/docker/calibre-web-default/data:/config -v /mnt/toshiba/docker/calibre-web-default/library:/books --restart unless-stopped linuxserver/calibre-web:0.6.21</span>
</pre></div>
</div>
<p><strong>Parameters</strong></p>
<table border="1" class="docutils">
<thead>
<tr>
<th>Parameter</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-p 8083</code></td>
<td>WebUI</td>
</tr>
<tr>
<td><code>-e PUID=1000</code></td>
<td>for UserID - see below for explanation</td>
</tr>
<tr>
<td><code>-e PGID=1000</code></td>
<td>for GroupID - see below for explanation</td>
</tr>
<tr>
<td><code>-e TZ=Etc/UTC</code></td>
<td>specify a timezone to use, see this <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones#List">list</a>.</td>
</tr>
<tr>
<td><code>-e DOCKER_MODS=linuxserver/mods:universal-calibre</code></td>
<td>#optional &amp; <strong>x86-64 only</strong> Adds the ability to perform ebook conversion</td>
</tr>
<tr>
<td><code>-e OAUTHLIB_RELAX_TOKEN_SCOPE=1</code></td>
<td>Optionally set this to allow Google OAUTH to work</td>
</tr>
<tr>
<td><code>-v /config</code></td>
<td>Where calibre-web stores the internal database and config.</td>
</tr>
<tr>
<td><code>-v /books</code></td>
<td>Where your preexisting calibre database is located.</td>
</tr>
</tbody>
</table><p><strong>Environment variables from files (Docker secrets)</strong></p>
<p>You can set any environment variable from a file by using a special prepend <code class="docutils literal notranslate"><span class="pre">FILE__</span></code>.</p>
<p>As an example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-e<span class="w"> </span><span class="nv">FILE__MYVAR</span><span class="o">=</span>/run/secrets/mysecretvariable
</pre></div>
</div>
<p>Will set the environment variable <code class="docutils literal notranslate"><span class="pre">MYVAR</span></code> based on the contents of the <code class="docutils literal notranslate"><span class="pre">/run/secrets/mysecretvariable</span></code> file.</p>
</section>
<section id="teamspeak">
<h1>teamspeak部署<a class="headerlink" href="#teamspeak" title="Link to this heading">¶</a></h1>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-p<span class="w"> </span><span class="m">9987</span>:9987/udp<span class="w"> </span>-p<span class="w"> </span><span class="m">10011</span>:10011<span class="w"> </span>-p<span class="w"> </span><span class="m">10022</span>:10022<span class="w"> </span>-p<span class="w"> </span><span class="m">10080</span>:10080<span class="w"> </span>-p<span class="w"> </span><span class="m">10443</span>:10443<span class="w"> </span>-p<span class="w"> </span><span class="m">30033</span>:30033<span class="w"> </span>-p<span class="w"> </span><span class="m">41144</span>:41144<span class="w"> </span>-e<span class="w"> </span><span class="nv">TS3SERVER_LICENSE</span><span class="o">=</span>accept<span class="w"> </span>--name<span class="w"> </span>teamspeak-default<span class="w"> </span>-d<span class="w"> </span>teamspeak
</pre></div>
</div>
<p>然后查看token，使用teamspeak client登陆</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>logs<span class="w"> </span>teamspeak-default
</pre></div>
</div>
</section>
<section id="kmswindoows-office">
<h1>kms服务器部署及windoows+office激活<a class="headerlink" href="#kmswindoows-office" title="Link to this heading">¶</a></h1>
<p>有两个kms服务器镜像，二选一部署即可：</p>
<section id="id21">
<h2>服务器部署<a class="headerlink" href="#id21" title="Link to this heading">¶</a></h2>
<section id="a-mogeko-vlmcsd">
<h3>镜像A：mogeko/vlmcsd<a class="headerlink" href="#a-mogeko-vlmcsd" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>mogeko/vlmcsd
sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>vlmcsd-default<span class="w"> </span>-p<span class="w"> </span><span class="m">1688</span>:1688<span class="w"> </span>--restart<span class="w"> </span>always<span class="w"> </span>mogeko/vlmcsd
</pre></div>
</div>
</section>
<section id="b-luodaoyi-kms-server">
<h3>镜像B：luodaoyi/kms-server<a class="headerlink" href="#b-luodaoyi-kms-server" title="Link to this heading">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>luodaoyi/kms-server
sudo<span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>--name<span class="w"> </span>kms-server-default<span class="w"> </span>-p<span class="w"> </span><span class="m">1688</span>:1688<span class="w"> </span>--restart<span class="w"> </span>always<span class="w"> </span>luodaoyi/kms-server
</pre></div>
</div>
</section>
</section>
<section id="id22">
<h2><a class="headerlink" href="#id22" title="Link to this heading">¶</a></h2>
</section>
</section>
<section id="docker-compose-spark-hadoop">
<h1>docker-compose spark+hadoop部署<a class="headerlink" href="#docker-compose-spark-hadoop" title="Link to this heading">¶</a></h1>
<section id="id23">
<h2>部署命令<a class="headerlink" href="#id23" title="Link to this heading">¶</a></h2>
<p>首先拉取singularities/spark:2.2镜像。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span>pull<span class="w"> </span>singularities/spark
</pre></div>
</div>
<p>创建工作目录，创建并修改docker-compose.yml。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>mkdir<span class="w"> </span>singularitiesCR
sudo<span class="w"> </span>touch<span class="w"> </span>docker-compose.yml
sudo<span class="w"> </span>vi<span class="w"> </span>docker-compose.yml
</pre></div>
</div>
<p>docker-compose.yml文件的内容如下，注意需要修改data目录与本机实际的data目录匹配。可以自行修改端口映射。</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2&quot;</span>
<span class="w"> </span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">master</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">singularities/spark</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">start-spark master</span>
<span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;6066:6066&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;7070:7070&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;8080:8080&quot;</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;50070:50070&quot;</span>
<span class="w">  </span><span class="nt">worker</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">singularities/spark</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">start-spark worker master</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_CORES</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_MEMORY</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2g</span>
<span class="w">    </span><span class="nt">links</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># 设置本地目录和镜像目录的映射关系（格式：本地机器目录:镜像中对应路径）</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/home/ubuntu/docker/spark-demo/singularitiesCR/data:/input_files</span>
</pre></div>
</div>
<p>运行容器、查看容器状态、停止容器、删除容器</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
sudo<span class="w"> </span>docker-compose<span class="w"> </span>ps
sudo<span class="w"> </span>docker-compose<span class="w"> </span>stop
sudo<span class="w"> </span>docker-compose<span class="w"> </span>rm
</pre></div>
</div>
<p>后台页面对应地址如下：</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Hadoop管理页面</span>
<span class="l l-Scalar l-Scalar-Plain">127.0.0.1:50070</span>
<span class="l l-Scalar l-Scalar-Plain"># Spark任务管理页面</span>
<span class="l l-Scalar l-Scalar-Plain">127.0.0.1:8080</span>
</pre></div>
</div>
</section>
</section>
<section id="docker-composespark-hadoop">
<h1>docker-compose搭建spark+hadoop集群<a class="headerlink" href="#docker-composespark-hadoop" title="Link to this heading">¶</a></h1>
<section id="dockerdocker-compose">
<h2>1、安装docker和docker-Compose<a class="headerlink" href="#dockerdocker-compose" title="Link to this heading">¶</a></h2>
<p><strong>(不推荐使用这里的步骤，请参阅最顶部的docker和docker-compose安装教程)</strong></p>
<section id="id24">
<h3>1.1、安装docker<a class="headerlink" href="#id24" title="Link to this heading">¶</a></h3>
<p>(如果机器中已经安装过docker，可以直接跳过)</p>
<p>关闭防火墙</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>stop<span class="w"> </span>firewalld
sudo<span class="w"> </span>systemctl<span class="w"> </span>disable<span class="w"> </span>firewalld
sudo<span class="w"> </span>systemctl<span class="w"> </span>status<span class="w"> </span>firewalld
</pre></div>
</div>
<p>设置SELinux成为permissive模式（临时关闭SELinux）</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>setenforce<span class="w"> </span><span class="m">0</span>
sudo<span class="w"> </span>getenforce
</pre></div>
</div>
<p>更换yum源为阿里源加速</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>yum<span class="w"> </span>-y<span class="w"> </span>update
sudo<span class="w"> </span>mkdir<span class="w"> </span>/etc/yum.repos.d/oldrepo
sudo<span class="w"> </span>mv<span class="w"> </span>/etc/yum.repos.d/*.repo<span class="w"> </span>/etc/yum.repos.d/oldrepo/
sudo<span class="w"> </span>wget<span class="w"> </span>-O<span class="w"> </span>/etc/yum.repos.d/CentOS-Base.repo<span class="w"> </span>http://mirrors.aliyun.com/repo/Centos-7.repo
sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>yum-utils<span class="w"> </span>device-mapper-persistent-data<span class="w"> </span>lvm2
sudo<span class="w"> </span>yum-config-manager<span class="w"> </span>--add-repo<span class="w"> </span>http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
sudo<span class="w"> </span>yum<span class="w"> </span>clean<span class="w"> </span>all
sudo<span class="w"> </span>yum<span class="w"> </span>makecache<span class="w"> </span>fast
</pre></div>
</div>
<p>安装docker</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>yum<span class="w"> </span>list<span class="w"> </span>docker-ce<span class="w"> </span>--showduplicates<span class="w"> </span><span class="p">|</span><span class="w"> </span>sort<span class="w"> </span>-r
sudo<span class="w"> </span>yum<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>docker-ce
sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>docker
sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>docker
sudo<span class="w"> </span>ps<span class="w"> </span>-ef<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>docker
sudo<span class="w"> </span>docker<span class="w"> </span>version
</pre></div>
</div>
<p>到这一步能正常输出docker版本，说明docker已经成功安装。</p>
<p>为了后续拉取镜像能更快，需要添加一个镜像：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/docker/daemon.json
</pre></div>
</div>
<p>添加以下内容，保存退出</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;registry-mirrors&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;https://x3n9jrcg.mirror.aliyuncs.com&quot;</span><span class="p">]</span>
<span class="w"> </span><span class="p">}</span>
</pre></div>
</div>
<p>重启docker</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>docker
</pre></div>
</div>
<p>后面需要用git拉取一些资源，所以要安装git，为了能够正常访问github，需要修改一下hosts文件</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>yum<span class="w"> </span>-y<span class="w"> </span>install<span class="w"> </span>git
sudo<span class="w"> </span>sudo<span class="w"> </span>vi<span class="w"> </span>/etc/hosts
</pre></div>
</div>
<p>添加以下内容：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mf">192.30.255.112</span>  <span class="n">github</span><span class="o">.</span><span class="n">com</span> <span class="n">git</span>
</pre></div>
</div>
</section>
<section id="id25">
<h3>1.2、安装docker-Compose<a class="headerlink" href="#id25" title="Link to this heading">¶</a></h3>
<p>(如果已经安装过docker-compose，可以直接跳过)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>curl<span class="w"> </span>-L<span class="w"> </span>https://get.daocloud.io/docker/compose/releases/download/1.27.4/docker-compose-<span class="sb">`</span>uname<span class="w"> </span>-s<span class="sb">`</span>-<span class="sb">`</span>uname<span class="w"> </span>-m<span class="sb">`</span><span class="w"> </span>&gt;<span class="w"> </span>/usr/local/bin/docker-compose
sudo<span class="w"> </span>chmod<span class="w"> </span>+x<span class="w"> </span>/usr/local/bin/docker-compose
sudo<span class="w"> </span>docker-compose<span class="w"> </span>--version
</pre></div>
</div>
<p>能够正常输出docker-compose版本号，说明成功安装。</p>
</section>
</section>
<section id="spark-hdfs">
<h2>2、极速搭建Spark集群（含HDFS集群）<a class="headerlink" href="#spark-hdfs" title="Link to this heading">¶</a></h2>
<p>先创建一个文件夹用来存放配置文件，集群的安装路径也会是这个文件夹，所以想好放在哪里比较好，我的路径是：/home/ubuntu/docker/sparkcluster_hdfs/</p>
<section id="hadoop-env">
<h3>2.1、编辑hadoop.env配置文件<a class="headerlink" href="#hadoop-env" title="Link to this heading">¶</a></h3>
<p>进入你创建的目录编辑hadoop.env配置文件，我这里是/home/sparkcluster_hdfs目录：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/home/ubuntu/docker/sparkcluster_hdfs/
<span class="nb">cd</span><span class="w"> </span>/home/ubuntu/docker/sparkcluster_hdfs/
sudo<span class="w"> </span>touch<span class="w"> </span>hadoop.env
sudo<span class="w"> </span>vi<span class="w"> </span>hadoop.env
</pre></div>
</div>
<p>复制以下内容进去保存</p>
<div class="highlight-env notranslate"><div class="highlight"><pre><span></span>CORE_CONF_fs_defaultFS=hdfs://namenode:8020
CORE_CONF_hadoop_http_staticuser_user=root
CORE_CONF_hadoop_proxyuser_hue_hosts=*
CORE_CONF_hadoop_proxyuser_hue_groups=*

HDFS_CONF_dfs_webhdfs_enabled=true
HDFS_CONF_dfs_permissions_enabled=false

YARN_CONF_yarn_log___aggregation___enable=true
YARN_CONF_yarn_resourcemanager_recovery_enabled=true
YARN_CONF_yarn_resourcemanager_store_class=org.apache.hadoop.yarn.server.resourcemanager.recovery.FileSystemRMStateStore
YARN_CONF_yarn_resourcemanager_fs_state___store_uri=/rmstate
YARN_CONF_yarn_nodemanager_remote___app___log___dir=/app-logs
YARN_CONF_yarn_log_server_url=http://historyserver:8188/applicationhistory/logs/
YARN_CONF_yarn_timeline___service_enabled=true
YARN_CONF_yarn_timeline___service_generic___application___history_enabled=true
YARN_CONF_yarn_resourcemanager_system___metrics___publisher_enabled=true
YARN_CONF_yarn_resourcemanager_hostname=resourcemanager
YARN_CONF_yarn_timeline___service_hostname=historyserver
YARN_CONF_yarn_resourcemanager_address=resourcemanager:8032
YARN_CONF_yarn_resourcemanager_scheduler_address=resourcemanager:8030
YARN_CONF_yarn_resourcemanager_resource___tracker_address=resourcemanager:8031
</pre></div>
</div>
</section>
<section id="docker-compose-yml">
<h3>2.2、编辑docker-compose.yml编排配置文件<a class="headerlink" href="#docker-compose-yml" title="Link to this heading">¶</a></h3>
<p>还是在/home/sparkcluster_hdfs目录编辑docker-compose.yml编排配置文件：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/home/ubuntu/docker/sparkcluster_hdfs/
sudo<span class="w"> </span>touch<span class="w"> </span>docker-compose.yml
sudo<span class="w"> </span>vi<span class="w"> </span>docker-compose.yml
</pre></div>
</div>
<p>复制以下内容进去保存
注意：spark的worker数量，以及worker内存的分配，都可以通过修改docker-compose.yml文件来调整。</p>
<section id="datanode-6worker-yml">
<h4>1、此为（3datanode+6worker）的yml文件示例<a class="headerlink" href="#datanode-6worker-yml" title="Link to this heading">¶</a></h4>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2.2&quot;</span>
<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">namenode</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bde2020/hadoop-namenode:1.1.0-hadoop2.7.1-java8</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namenode</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./hadoop/namenode:/hadoop/dfs/name</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./input_files:/input_files</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CLUSTER_NAME=test</span>
<span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./hadoop.env</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50070:50070</span>

<span class="w">  </span><span class="nt">resourcemanager</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bde2020/hadoop-resourcemanager:1.1.0-hadoop2.7.1-java8</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">resourcemanager</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namenode</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datanode1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datanode2</span>
<span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./hadoop.env</span>

<span class="w">  </span><span class="nt">historyserver</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bde2020/hadoop-historyserver:1.1.0-hadoop2.7.1-java8</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">historyserver</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namenode</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datanode1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datanode2</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./hadoop/historyserver:/hadoop/yarn/timeline</span>
<span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./hadoop.env</span>

<span class="w">  </span><span class="nt">nodemanager1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bde2020/hadoop-nodemanager:1.1.0-hadoop2.7.1-java8</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nodemanager1</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namenode</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datanode1</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datanode2</span>
<span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./hadoop.env</span>

<span class="w">  </span><span class="nt">datanode1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bde2020/hadoop-datanode:1.1.0-hadoop2.7.1-java8</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datanode1</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namenode</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./hadoop/datanode1:/hadoop/dfs/data</span>
<span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./hadoop.env</span>

<span class="w">  </span><span class="nt">datanode2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bde2020/hadoop-datanode:1.1.0-hadoop2.7.1-java8</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datanode2</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namenode</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./hadoop/datanode2:/hadoop/dfs/data</span>
<span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./hadoop.env</span>

<span class="w">  </span><span class="nt">datanode3</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bde2020/hadoop-datanode:1.1.0-hadoop2.7.1-java8</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datanode3</span>
<span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namenode</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./hadoop/datanode3:/hadoop/dfs/data</span>
<span class="w">    </span><span class="nt">env_file</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./hadoop.env</span>

<span class="w">  </span><span class="nt">master</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gettyimages/spark:2.3.0-hadoop-2.8</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bin/spark-class org.apache.spark.deploy.master.Master -h master</span>
<span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">MASTER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">spark://master:7077</span>
<span class="w">      </span><span class="nt">SPARK_CONF_DIR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/conf</span>
<span class="w">      </span><span class="nt">SPARK_PUBLIC_DNS</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
<span class="w">    </span><span class="nt">links</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">namenode</span>
<span class="w">    </span><span class="nt">expose</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4040</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7001</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7002</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7003</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7004</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7005</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7077</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6066</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4040:4040</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6066:6066</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7077:7077</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080:8080</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./conf/master:/conf</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./data:/tmp/data</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./jars:/root/jars</span>

<span class="w">  </span><span class="nt">worker1</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gettyimages/spark:2.3.0-hadoop-2.8</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">worker1</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bin/spark-class org.apache.spark.deploy.worker.Worker spark://master:7077</span>
<span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">worker1</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">SPARK_CONF_DIR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/conf</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_CORES</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_MEMORY</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1g</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8881</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_WEBUI_PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8081</span>
<span class="w">      </span><span class="nt">SPARK_PUBLIC_DNS</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
<span class="w">    </span><span class="nt">links</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
<span class="w">    </span><span class="nt">expose</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7012</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7013</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7014</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7015</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8881</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8081</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8081:8081</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./conf/worker1:/conf</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./data/worker1:/tmp/data</span>

<span class="w">  </span><span class="nt">worker2</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gettyimages/spark:2.3.0-hadoop-2.8</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">worker2</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bin/spark-class org.apache.spark.deploy.worker.Worker spark://master:7077</span>
<span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">worker2</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">SPARK_CONF_DIR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/conf</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_CORES</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_MEMORY</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1g</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8881</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_WEBUI_PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8082</span>
<span class="w">      </span><span class="nt">SPARK_PUBLIC_DNS</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
<span class="w">    </span><span class="nt">links</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
<span class="w">    </span><span class="nt">expose</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7012</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7013</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7014</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7015</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8881</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8082</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8082:8082</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./conf/worker2:/conf</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./data/worker2:/tmp/data</span><span class="w">     </span>

<span class="w">  </span><span class="nt">worker3</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gettyimages/spark:2.3.0-hadoop-2.8</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">worker3</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bin/spark-class org.apache.spark.deploy.worker.Worker spark://master:7077</span>
<span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">worker3</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">SPARK_CONF_DIR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/conf</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_CORES</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_MEMORY</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1g</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8881</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_WEBUI_PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8083</span>
<span class="w">      </span><span class="nt">SPARK_PUBLIC_DNS</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
<span class="w">    </span><span class="nt">links</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
<span class="w">    </span><span class="nt">expose</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7012</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7013</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7014</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7015</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8881</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8083</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8083:8083</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./conf/worker3:/conf</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./data/worker3:/tmp/data</span>

<span class="w">  </span><span class="nt">worker4</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gettyimages/spark:2.3.0-hadoop-2.8</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">worker4</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bin/spark-class org.apache.spark.deploy.worker.Worker spark://master:7077</span>
<span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">worker4</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">SPARK_CONF_DIR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/conf</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_CORES</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_MEMORY</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1g</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8881</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_WEBUI_PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8084</span>
<span class="w">      </span><span class="nt">SPARK_PUBLIC_DNS</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
<span class="w">    </span><span class="nt">links</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
<span class="w">    </span><span class="nt">expose</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7012</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7013</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7014</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7015</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8881</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8084</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8084:8084</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./conf/worker4:/conf</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./data/worker4:/tmp/data</span>

<span class="w">  </span><span class="nt">worker5</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gettyimages/spark:2.3.0-hadoop-2.8</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">worker5</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bin/spark-class org.apache.spark.deploy.worker.Worker spark://master:7077</span>
<span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">worker5</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">SPARK_CONF_DIR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/conf</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_CORES</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_MEMORY</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1g</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8881</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_WEBUI_PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8085</span>
<span class="w">      </span><span class="nt">SPARK_PUBLIC_DNS</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
<span class="w">    </span><span class="nt">links</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
<span class="w">    </span><span class="nt">expose</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7012</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7013</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7014</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7015</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8881</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8085</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8085:8085</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./conf/worker5:/conf</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./data/worker5:/tmp/data</span>

<span class="w">  </span><span class="nt">worker6</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gettyimages/spark:2.3.0-hadoop-2.8</span>
<span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">worker6</span>
<span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bin/spark-class org.apache.spark.deploy.worker.Worker spark://master:7077</span>
<span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">worker6</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">SPARK_CONF_DIR</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/conf</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_CORES</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_MEMORY</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1g</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8881</span>
<span class="w">      </span><span class="nt">SPARK_WORKER_WEBUI_PORT</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8086</span>
<span class="w">      </span><span class="nt">SPARK_PUBLIC_DNS</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">localhost</span>
<span class="w">    </span><span class="nt">links</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">master</span>
<span class="w">    </span><span class="nt">expose</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7012</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7013</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7014</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7015</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8881</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8086</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8086:8086</span>
<span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./conf/worker6:/conf</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./data/worker6:/tmp/data</span>
</pre></div>
</div>
</section>
<section id="datanode-3worker-yml">
<h4>2、此为（2datanode+3worker）的yml文件示例<a class="headerlink" href="#datanode-3worker-yml" title="Link to this heading">¶</a></h4>
<div class="highlight-yml notranslate"><div class="highlight"><pre><span></span>version: &quot;2.2&quot;
services:
  namenode:
    image: bde2020/hadoop-namenode:1.1.0-hadoop2.7.1-java8
    container_name: namenode
    volumes:
      - ./hadoop/namenode:/hadoop/dfs/name
      - ./input_files:/input_files
    environment:
      - CLUSTER_NAME=test
    env_file:
      - ./hadoop.env
    ports:
      - 50070:50070

  resourcemanager:
    image: bde2020/hadoop-resourcemanager:1.1.0-hadoop2.7.1-java8
    container_name: resourcemanager
    depends_on:
      - namenode
      - datanode1
      - datanode2
    env_file:
      - ./hadoop.env

  historyserver:
    image: bde2020/hadoop-historyserver:1.1.0-hadoop2.7.1-java8
    container_name: historyserver
    depends_on:
      - namenode
      - datanode1
      - datanode2
    volumes:
      - ./hadoop/historyserver:/hadoop/yarn/timeline
    env_file:
      - ./hadoop.env

  nodemanager1:
    image: bde2020/hadoop-nodemanager:1.1.0-hadoop2.7.1-java8
    container_name: nodemanager1
    depends_on:
      - namenode
      - datanode1
      - datanode2
    env_file:
      - ./hadoop.env

  datanode1:
    image: bde2020/hadoop-datanode:1.1.0-hadoop2.7.1-java8
    container_name: datanode1
    depends_on:
      - namenode
    volumes:
      - ./hadoop/datanode1:/hadoop/dfs/data
    env_file:
      - ./hadoop.env

  datanode2:
    image: bde2020/hadoop-datanode:1.1.0-hadoop2.7.1-java8
    container_name: datanode2
    depends_on:
      - namenode
    volumes:
      - ./hadoop/datanode2:/hadoop/dfs/data
    env_file:
      - ./hadoop.env

  master:
    image: gettyimages/spark:2.3.0-hadoop-2.8
    container_name: master
    command: bin/spark-class org.apache.spark.deploy.master.Master -h master
    hostname: master
    environment:
      MASTER: spark://master:7077
      SPARK_CONF_DIR: /conf
      SPARK_PUBLIC_DNS: localhost
    links:
      - namenode
    expose:
      - 4040
      - 7001
      - 7002
      - 7003
      - 7004
      - 7005
      - 7077
      - 6066
    ports:
      - 4040:4040
      - 6066:6066
      - 7077:7077
      - 8080:8080
    volumes:
      - ./conf/master:/conf
      - ./data:/tmp/data
      - ./jars:/root/jars

  worker1:
    image: gettyimages/spark:2.3.0-hadoop-2.8
    container_name: worker1
    command: bin/spark-class org.apache.spark.deploy.worker.Worker spark://master:7077
    hostname: worker1
    environment:
      SPARK_CONF_DIR: /conf
      SPARK_WORKER_CORES: 1
      SPARK_WORKER_MEMORY: 1g
      SPARK_WORKER_PORT: 8881
      SPARK_WORKER_WEBUI_PORT: 8081
      SPARK_PUBLIC_DNS: localhost
    links:
      - master
    expose:
      - 7012
      - 7013
      - 7014
      - 7015
      - 8881
      - 8081
    ports:
      - 8081:8081
    volumes:
      - ./conf/worker1:/conf
      - ./data/worker1:/tmp/data

  worker2:
    image: gettyimages/spark:2.3.0-hadoop-2.8
    container_name: worker2
    command: bin/spark-class org.apache.spark.deploy.worker.Worker spark://master:7077
    hostname: worker2
    environment:
      SPARK_CONF_DIR: /conf
      SPARK_WORKER_CORES: 1
      SPARK_WORKER_MEMORY: 1g
      SPARK_WORKER_PORT: 8881
      SPARK_WORKER_WEBUI_PORT: 8082
      SPARK_PUBLIC_DNS: localhost
    links:
      - master
    expose:
      - 7012
      - 7013
      - 7014
      - 7015
      - 8881
      - 8082
    ports:
      - 8082:8082
    volumes:
      - ./conf/worker2:/conf
      - ./data/worker2:/tmp/data     

  worker3:
    image: gettyimages/spark:2.3.0-hadoop-2.8
    container_name: worker3
    command: bin/spark-class org.apache.spark.deploy.worker.Worker spark://master:7077
    hostname: worker3
    environment:
      SPARK_CONF_DIR: /conf
      SPARK_WORKER_CORES: 1
      SPARK_WORKER_MEMORY: 1g
      SPARK_WORKER_PORT: 8881
      SPARK_WORKER_WEBUI_PORT: 8083
      SPARK_PUBLIC_DNS: localhost
    links:
      - master
    expose:
      - 7012
      - 7013
      - 7014
      - 7015
      - 8881
      - 8083
    ports:
      - 8083:8083
    volumes:
      - ./conf/worker3:/conf
      - ./data/worker3:/tmp/data
</pre></div>
</div>
</section>
</section>
<section id="id26">
<h3>2.3、执行docker-compose命令，一键搭建集群<a class="headerlink" href="#id26" title="Link to this heading">¶</a></h3>
<p>还是在/home/sparkcluster_hdfs目录下，执行命令：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker-compose<span class="w"> </span>up<span class="w"> </span>-d
</pre></div>
</div>
<p>接下来静候命令执行完成，整个spark和hdfs集群环境就搭建好了。</p>
</section>
<section id="id27">
<h3>2.4、查看集群环境<a class="headerlink" href="#id27" title="Link to this heading">¶</a></h3>
<p>在/home/sparkcluster_hdfs目录查看容器情况：</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker-compose<span class="w"> </span>ps
</pre></div>
</div>
<p>用浏览器查看hdfs，如下图，可见有三个DataNode
地址是：http://centos机器的ip:50070，e.g.: 127.0.0.1:50070</p>
<p><img alt="2" src="_images/2.png" /></p>
<p>浏览器查看spark，如下图，可见有六个worker
地址是：http://centos机器的ip:8080，e.g.: 127.0.0.1:8080</p>
<p><img alt="3" src="_images/3.png" /></p>
<p><strong>在CentOS机器的命令行输入以下命令，即可创建一个spark_shell：</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>master<span class="w"> </span>spark-shell<span class="w"> </span>--executor-memory<span class="w"> </span>512M<span class="w"> </span>--total-executor-cores<span class="w"> </span><span class="m">2</span>
</pre></div>
</div>
</section>
</section>
<section id="spark">
<h2>3、spark集群开机自启动<a class="headerlink" href="#spark" title="Link to this heading">¶</a></h2>
<p>spark集群和hdfs集群由多个容器各司其职来完成整个工作的，每个容器启动有顺序要求，官方通过 docker-compose.yml 文件对容器进行编排，使用 depends_on 定义依赖关系决定了容器的启动顺序。常规来说，正常使用 docker-compose 来启动容器不会存在任何问题，各个容器服务都能正常启动并运行。</p>
<p>我们上面配置的docker-compose.yml文件中并没有给容器配置开机自启（restart: always）</p>
<p>但是…</p>
<p>如果你在docker-compose.yml 中为所有容器都配置了 restart: always
这表示所有的容器在意外关闭后都会自动重启，比如 docker 重启或服务器重启。</p>
<p>然而…</p>
<p>docker 本身对容器的启动是不区分顺序的，也就是你可以认为 depends_on 是 docker-compose 独有的功能。当我们服务器重启后，docker 会将设定 restart: always 的容器启动（不分先后顺序）。而我们实际的业务需要又会因为启动顺序问题导致一些容器启动失败，这样就出现了我们的集群在服务器重启后可能出现部分容器启动失败的问题。</p>
<p>那么，如何解决这个问题呢？</p>
<p>写一个系统服务（将 spark和hdfs集群 配置为 systemd 的 service），将 docker-compose up -d 纳入启动命令中，将 docker-compose stop纳入停止命令中，这样将服务配置为随系统启动即可。</p>
<section id="id28">
<h3>3.1、自定义系统服务<a class="headerlink" href="#id28" title="Link to this heading">¶</a></h3>
<p>进入到/usr/lib/systemd/system/目录，并编辑一个spark和hdfs集群的服务配置文件（这里我把文件命名为：sparkcluster_hdfs.service）:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>/usr/lib/systemd/system/
sudo<span class="w"> </span>vi<span class="w"> </span>sparkcluster_hdfs.service
</pre></div>
</div>
<p>添加以下内容：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">Unit</span><span class="p">]</span>
<span class="n">Description</span><span class="o">=</span><span class="n">sparkcluster_hdfs</span>
<span class="n">After</span><span class="o">=</span><span class="n">docker</span><span class="o">.</span><span class="n">service</span> <span class="n">systemd</span><span class="o">-</span><span class="n">networkd</span><span class="o">.</span><span class="n">service</span> <span class="n">systemd</span><span class="o">-</span><span class="n">resolved</span><span class="o">.</span><span class="n">service</span>
<span class="n">Requires</span><span class="o">=</span><span class="n">docker</span><span class="o">.</span><span class="n">service</span>
<span class="n">Documentation</span><span class="o">=</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">www</span><span class="o">.</span><span class="n">baidu</span><span class="o">.</span><span class="n">com</span><span class="o">/</span>

<span class="p">[</span><span class="n">Service</span><span class="p">]</span>
<span class="n">Type</span><span class="o">=</span><span class="n">simple</span>
<span class="n">Restart</span><span class="o">=</span><span class="n">always</span>
<span class="n">RestartSec</span><span class="o">=</span><span class="mi">5</span>
<span class="n">PrivateTmp</span><span class="o">=</span><span class="n">true</span>
<span class="n">ExecStart</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sparkcluster_hdfs</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">.</span><span class="n">yml</span> <span class="n">up</span>
<span class="n">ExecReload</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sparkcluster_hdfs</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">.</span><span class="n">yml</span> <span class="n">restart</span>
<span class="n">ExecStop</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">sparkcluster_hdfs</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">.</span><span class="n">yml</span> <span class="n">stop</span>

<span class="p">[</span><span class="n">Install</span><span class="p">]</span>
<span class="n">WantedBy</span><span class="o">=</span><span class="n">multi</span><span class="o">-</span><span class="n">user</span><span class="o">.</span><span class="n">target</span>
</pre></div>
</div>
<p>这里面的路径只能是绝对路径！！！
docker-compose 的绝对路径，可以通过命令 which docker-compose 查看。</p>
</section>
<section id="id29">
<h3>3.2、设置服务为随系统自启<a class="headerlink" href="#id29" title="Link to this heading">¶</a></h3>
<p>设置开机自启</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>sparkcluster_hdfs
</pre></div>
</div>
<p>启动服务</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>sparkcluster_hdfs
</pre></div>
</div>
<p>最后，重启你的服务器验证一下结果。</p>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">目录</a></h3>
    <ul>
<li><a class="reference internal" href="#">docker安装</a><ul>
<li><a class="reference internal" href="#for-ubuntu">官方教程 for Ubuntu</a></li>
<li><a class="reference internal" href="#tsinghua">使用Tsinghua源</a></li>
<li><a class="reference internal" href="#id1">使用阿里源(推荐使用)</a></li>
<li><a class="reference internal" href="#ustc">使用ustc源</a></li>
<li><a class="reference internal" href="#sjtu">使用sjtu源</a></li>
</ul>
</li>
<li><a class="reference internal" href="#docker-compose">docker-compose安装</a><ul>
<li><a class="reference internal" href="#apt">apt安装</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id2">docker走代理</a></li>
<li><a class="reference internal" href="#wsldocker">WSL设置docker代理</a></li>
<li><a class="reference internal" href="#portainer-docker">Portainer(docker面板)</a></li>
<li><a class="reference internal" href="#grafana">Grafana</a></li>
<li><a class="reference internal" href="#uptime-kuma">uptime-kuma(应用监控)</a></li>
<li><a class="reference internal" href="#minio">minio(分布式对象存储服务器)</a></li>
<li><a class="reference internal" href="#sun-panel">sun-panel</a></li>
<li><a class="reference internal" href="#panel-linux">1panel(Linux运维面板)</a></li>
<li><a class="reference internal" href="#code-server">code-server</a><ul>
<li><a class="reference internal" href="#codercon-code-server">codercon/code-server</a></li>
<li><a class="reference internal" href="#linuxserver-code-server">linuxserver/code-server</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mysql8">mysql8部署</a><ul>
<li><a class="reference internal" href="#id3">部署命令</a></li>
<li><a class="reference internal" href="#id4">配置命令</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mysql5-7">mysql5.7部署</a><ul>
<li><a class="reference internal" href="#id5">部署命令</a></li>
<li><a class="reference internal" href="#id6">配置命令</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mongodb">mongodb部署</a><ul>
<li><a class="reference internal" href="#id7">部署命令</a></li>
</ul>
</li>
<li><a class="reference internal" href="#apache2">apache2部署</a><ul>
<li><a class="reference internal" href="#id8">部署命令</a></li>
<li><a class="reference internal" href="#id9">配置命令</a><ul>
<li><a class="reference internal" href="#id10">修改中文显示</a></li>
<li><a class="reference internal" href="#id11">设置需要密码访问</a></li>
<li><a class="reference internal" href="#id12">自定义404等页面</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#navidrome">navidrome自建音乐播放器</a></li>
<li><a class="reference internal" href="#jellyfin">jellyfin</a></li>
<li><a class="reference internal" href="#kodexplorer">kodexplorer</a><ul>
<li><a class="reference internal" href="#id13">1.快速启动</a></li>
<li><a class="reference internal" href="#id14">2.实现数据持久化——创建数据目录并在启动时挂载</a></li>
</ul>
</li>
<li><a class="reference internal" href="#nextcloud">nextcloud部署</a><ul>
<li><a class="reference internal" href="#id15">部署命令</a></li>
<li><a class="reference internal" href="#nextcloud-0770"><strong>错误：nextcloud 您的数据目录可被其他用户读取 请更改权限为 0770 以避免其他用户查看目录</strong></a></li>
<li><a class="reference internal" href="#nextcloud-ip-ip">Nextcloud 通过不被信任的域名访问 动态IP解决方案，允许所有IP访问</a></li>
</ul>
</li>
<li><a class="reference internal" href="#onlyoffice">onlyoffice部署</a><ul>
<li><a class="reference internal" href="#id16">部署命令</a></li>
<li><a class="reference internal" href="#id17">配置命令</a></li>
<li><a class="reference internal" href="#nextcloudonlyoffice">nextcloud与onlyoffice链接</a></li>
</ul>
</li>
<li><a class="reference internal" href="#jupyter-base-notebook">jupyter/base-notebook配置</a><ul>
<li><a class="reference internal" href="#id18">镜像拉取</a></li>
<li><a class="reference internal" href="#id19">创建容器</a></li>
<li><a class="reference internal" href="#id20">修改中文</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rtmp">rtmp</a><ul>
<li><a class="reference internal" href="#to-stream-to-the-server">To stream to the server</a></li>
</ul>
</li>
<li><a class="reference internal" href="#calibre-web">calibre-web部署</a></li>
<li><a class="reference internal" href="#teamspeak">teamspeak部署</a></li>
<li><a class="reference internal" href="#kmswindoows-office">kms服务器部署及windoows+office激活</a><ul>
<li><a class="reference internal" href="#id21">服务器部署</a><ul>
<li><a class="reference internal" href="#a-mogeko-vlmcsd">镜像A：mogeko/vlmcsd</a></li>
<li><a class="reference internal" href="#b-luodaoyi-kms-server">镜像B：luodaoyi/kms-server</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id22"></a></li>
</ul>
</li>
<li><a class="reference internal" href="#docker-compose-spark-hadoop">docker-compose spark+hadoop部署</a><ul>
<li><a class="reference internal" href="#id23">部署命令</a></li>
</ul>
</li>
<li><a class="reference internal" href="#docker-composespark-hadoop">docker-compose搭建spark+hadoop集群</a><ul>
<li><a class="reference internal" href="#dockerdocker-compose">1、安装docker和docker-Compose</a><ul>
<li><a class="reference internal" href="#id24">1.1、安装docker</a></li>
<li><a class="reference internal" href="#id25">1.2、安装docker-Compose</a></li>
</ul>
</li>
<li><a class="reference internal" href="#spark-hdfs">2、极速搭建Spark集群（含HDFS集群）</a><ul>
<li><a class="reference internal" href="#hadoop-env">2.1、编辑hadoop.env配置文件</a></li>
<li><a class="reference internal" href="#docker-compose-yml">2.2、编辑docker-compose.yml编排配置文件</a><ul>
<li><a class="reference internal" href="#datanode-6worker-yml">1、此为（3datanode+6worker）的yml文件示例</a></li>
<li><a class="reference internal" href="#datanode-3worker-yml">2、此为（2datanode+3worker）的yml文件示例</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id26">2.3、执行docker-compose命令，一键搭建集群</a></li>
<li><a class="reference internal" href="#id27">2.4、查看集群环境</a></li>
</ul>
</li>
<li><a class="reference internal" href="#spark">3、spark集群开机自启动</a><ul>
<li><a class="reference internal" href="#id28">3.1、自定义系统服务</a></li>
<li><a class="reference internal" href="#id29">3.2、设置服务为随系统自启</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
  <div role="note" aria-label="source link">
    <h3>本页</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/Docker.md.txt"
            rel="nofollow">显示源代码</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">快速搜索</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="提交" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>导航</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="总索引"
             >索引</a></li>
        <li class="nav-item nav-item-0"><a href="index.html">个人笔记教程 1.0.0 文档</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">docker安装</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; 版权所有 2024, georgeghl.
      由 <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7创建。
    </div>
  </body>
</html>